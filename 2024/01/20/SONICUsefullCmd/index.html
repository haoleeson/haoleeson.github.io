<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/my-avatar.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/my-favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/my-favicon-16x16.png">
  <link rel="mask-icon" href="/images/my-logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"haoleeson.cn","root":"/","images":"/images","scheme":"Muse","version":"8.7.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":true,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>
<meta name="description" content="SONiC作为著名的白盒交换机操作系统，其容器化架构为白盒场景提供了的极大灵活性，及活跃卓越的社区环境，在业内自研交换机领域被广泛使用，本文记录SONiC一些工作中常用的配置与排障相关指令。">
<meta property="og:type" content="article">
<meta property="og:title" content="SONiC常用命令">
<meta property="og:url" content="https://haoleeson.cn/2024/01/20/SONICUsefullCmd/index.html">
<meta property="og:site_name" content="Haoleeson&#39;s Notes">
<meta property="og:description" content="SONiC作为著名的白盒交换机操作系统，其容器化架构为白盒场景提供了的极大灵活性，及活跃卓越的社区环境，在业内自研交换机领域被广泛使用，本文记录SONiC一些工作中常用的配置与排障相关指令。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-01-20T14:30:45.000Z">
<meta property="article:modified_time" content="2024-01-20T14:30:45.000Z">
<meta property="article:author" content="haoleeson">
<meta property="article:tag" content="Network">
<meta property="article:tag" content="SONiC">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://haoleeson.cn/2024/01/20/SONICUsefullCmd/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://haoleeson.cn/2024/01/20/SONICUsefullCmd/","path":"2024/01/20/SONICUsefullCmd/","title":"SONiC常用命令"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>SONiC常用命令 | Haoleeson's Notes</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Haoleeson's Notes</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Record growth and enjoy life!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-landmark fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-cloud fa-fw"></i>云标签</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-hourglass-start fa-fw"></i>时间轴</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          目录
        </li>
        <li class="sidebar-nav-overview">
          概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-%E7%AB%AF%E5%8F%A3"><span class="nav-text">1. 端口</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-%E6%9F%A5%E7%9C%8B%E7%AB%AF%E5%8F%A3%E7%8A%B6%E6%80%81"><span class="nav-text">1.1. 查看端口状态</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-%E7%AB%AF%E5%8F%A3up-x2F-down"><span class="nav-text">1.2. 端口up&#x2F;down</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-%E6%B7%BB%E5%8A%A0%E4%B8%89%E5%B1%82IP"><span class="nav-text">1.3. 添加三层IP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-4-%E8%81%9A%E5%90%88%E9%93%BE%E8%B7%AF"><span class="nav-text">1.4. 聚合链路</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-5-VLAN"><span class="nav-text">1.5. VLAN</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-6-%E5%85%89%E6%A8%A1%E5%9D%97"><span class="nav-text">1.6. 光模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-7-%E6%9F%A5%E7%9C%8B%E7%AB%AF%E5%8F%A3%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-text">1.7. 查看端口配置文件</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-%E5%B8%B8%E7%94%A8-cli-%E5%91%BD%E4%BB%A4"><span class="nav-text">2. 常用 cli 命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-%E4%BB%8E-cli-%E8%BF%9B%E5%85%A5-Linux-shell"><span class="nav-text">2.1. 从 cli 进入 Linux shell</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-bcmsh-%E4%B8%8B%E6%89%A7%E8%A1%8C%E8%84%9A%E6%9C%AC%E6%A8%A1%E6%8B%9F%E7%AB%AF%E5%8F%A3%E9%9C%87%E8%8D%A1"><span class="nav-text">2.2. bcmsh 下执行脚本模拟端口震荡</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3-%E5%B8%B8%E7%94%A8-cli-%E5%91%BD%E4%BB%A4"><span class="nav-text">2.3. 常用 cli 命令</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-%E8%B7%AF%E7%94%B1"><span class="nav-text">3. 路由</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-%E5%A2%9E%E5%88%A0%E8%B7%AF%E7%94%B1"><span class="nav-text">3.1. 增删路由</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-%E6%9F%A5%E7%9C%8Barp%E8%A1%A8"><span class="nav-text">3.2. 查看arp表</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-BGP"><span class="nav-text">4. BGP</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-%E9%85%8D%E7%BD%AE-BGP-%E9%82%BB%E5%B1%85"><span class="nav-text">4.1. 配置 BGP 邻居</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-%E5%81%9C%E6%AD%A2-x2F-%E6%89%93%E5%BC%80BGP%E9%82%BB%E5%B1%85"><span class="nav-text">4.2. 停止&#x2F;打开BGP邻居</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-3-%E6%9F%A5%E7%9C%8B-BGP-%E5%AE%A3%E5%91%8A%E7%BD%91%E6%AE%B5"><span class="nav-text">4.3. 查看 BGP 宣告网段</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-4-%E6%9F%A5%E7%9C%8B-bgp-%E6%8C%87%E5%AE%9A%E9%82%BB%E5%B1%85%E5%AE%A3%E5%91%8A%E8%B7%AF%E7%94%B1"><span class="nav-text">4.4. 查看 bgp 指定邻居宣告路由</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-5-redis-%E8%8E%B7%E5%8F%96-BGP-Neighbor-%E5%BB%BA%E9%93%BE%E7%8A%B6%E6%80%81"><span class="nav-text">4.5. redis 获取 BGP Neighbor 建链状态</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-vtysh"><span class="nav-text">5. vtysh</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#5-1-%E6%9F%A5%E7%9C%8B%E9%85%8D%E7%BD%AE"><span class="nav-text">5.1. 查看配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-2-%E9%80%9A%E8%BF%87-route-map-%E8%BF%87%E6%BB%A4%E8%B7%AF%E7%94%B1"><span class="nav-text">5.2. 通过 route-map 过滤路由</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-3-%E6%B7%BB%E5%8A%A0bgp-peer"><span class="nav-text">5.3. 添加bgp peer</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-4-%E5%AE%A3%E5%91%8A%E8%B7%AF%E7%94%B1"><span class="nav-text">5.4. 宣告路由</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-5-%E6%B7%BB%E5%8A%A0%E8%B7%AF%E7%94%B1"><span class="nav-text">5.5. 添加路由</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-6-vrf-%E5%91%BD%E4%BB%A4"><span class="nav-text">5.6. vrf 命令</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6-BMC"><span class="nav-text">6. BMC</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#6-1-Accton-%E8%AE%BE%E5%A4%87%E4%B8%B2%E5%8F%A3-%E5%88%87%E6%8D%A2-BMC-x2F-COME"><span class="nav-text">6.1. Accton 设备串口 切换 BMC&#x2F;COME</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-2-Accton-%E9%80%9A%E8%BF%87-usb0-%E5%8F%A3-SSH-%E8%AE%BF%E9%97%AE-OpenBMC"><span class="nav-text">6.2. Accton 通过 usb0 口 SSH 访问 OpenBMC</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-3-BMC-IP-%E9%85%8D%E7%BD%AE"><span class="nav-text">6.3. BMC IP 配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-4-BMC-%E4%BE%A7%E9%87%8D%E5%90%AF-COME-%E4%BE%A7"><span class="nav-text">6.4. BMC 侧重启 COME 侧</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-5-BMC-%E4%BE%A7%E9%87%8D%E5%90%AF-SONiC"><span class="nav-text">6.5. BMC 侧重启 SONiC</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#7-vEOS"><span class="nav-text">7. vEOS</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#7-1-vEOS-%E7%89%88%E6%9C%AC"><span class="nav-text">7.1. vEOS 版本</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-2-%E8%BF%9B%E5%85%A5-cli"><span class="nav-text">7.2. 进入 cli</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-3-%E6%9F%A5%E7%9C%8B-BGP-%E4%BF%A1%E6%81%AF"><span class="nav-text">7.3. 查看 BGP 信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-4-vEOS-%E9%85%8D%E7%BD%AE-BGP"><span class="nav-text">7.4. vEOS 配置 BGP</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#8-redis"><span class="nav-text">8. redis</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#8-1-Redis-%E5%90%84-DB-%E5%BA%8F%E5%8F%B7"><span class="nav-text">8.1. Redis 各 DB 序号</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-2-%E5%BC%80%E5%90%AF-redis-%E5%AE%B9%E5%99%A8%E4%B8%AD%E6%97%A5%E5%BF%97"><span class="nav-text">8.2. 开启 redis 容器中日志</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-3-%E7%9B%91%E5%90%ACredis%E4%BA%8B%E4%BB%B6"><span class="nav-text">8.3. 监听redis事件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-4-%E7%9B%91%E5%90%AC%E7%89%B9%E5%AE%9A-channel"><span class="nav-text">8.4. 监听特定 channel</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-5-%E6%89%B9%E9%87%8F%E5%A2%9E%E5%88%A0%E6%93%8D%E4%BD%9C-redis"><span class="nav-text">8.5. 批量增删操作 redis</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-6-Redis-%E5%A4%87%E4%BB%BD%E5%93%AA%E4%BA%9B%E8%A1%A8"><span class="nav-text">8.6. Redis 备份哪些表</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#9-Rsyslog"><span class="nav-text">9. Rsyslog</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#9-1-%E9%87%8D%E6%96%B0%E6%A0%B9%E6%8D%AE-lib-user-json-%E7%94%9F%E6%88%90-rsyslog-conf-%E5%B9%B6%E9%87%8D%E5%90%AF%E6%9C%8D%E5%8A%A1"><span class="nav-text">9.1. 重新根据 lib_user.json 生成 rsyslog.conf 并重启服务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-2-%E9%87%8D%E5%90%AF-Rsyslog-%E6%9C%8D%E5%8A%A1"><span class="nav-text">9.2. 重启 Rsyslog 服务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-3-%E6%9F%A5%E7%9C%8B%E6%9C%AC%E5%9C%B0%E6%97%A5%E5%BF%97%E7%AD%96%E7%95%A5"><span class="nav-text">9.3. 查看本地日志策略</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-4-%E6%9F%A5%E7%9C%8B-Rsyslog-%E6%97%A5%E5%BF%97%E4%B8%8A%E6%8A%A5%E7%AD%96%E7%95%A5"><span class="nav-text">9.4. 查看 Rsyslog 日志上报策略</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-5-%E6%9F%A5%E7%9C%8B-Rsyslog-%E8%BF%9C%E7%A8%8B%E6%97%A5%E5%BF%97%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%8A%B6%E6%80%81"><span class="nav-text">9.5. 查看 Rsyslog 远程日志服务器状态</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-6-Rsyslog-%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%B8%8E%E6%97%A5%E5%BF%97%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E9%85%8D%E7%BD%AE"><span class="nav-text">9.6. Rsyslog 客户端与日志服务器端配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#9-6-1-TCP-%E6%96%B9%E5%BC%8F"><span class="nav-text">9.6.1. TCP 方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-6-2-UDP-%E6%96%B9%E5%BC%8F"><span class="nav-text">9.6.2. UDP 方式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-7-%E6%A3%80%E6%9F%A5-Rsyslog-%E6%97%A5%E5%BF%97%E4%B8%8A%E6%8A%A5-%E9%85%8D%E7%BD%AE"><span class="nav-text">9.7. 检查 Rsyslog 日志上报 配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-8-cli-%E9%85%8D%E7%BD%AE%E8%BF%9C%E7%A8%8B%E6%97%A5%E5%BF%97%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-text">9.8. cli 配置远程日志服务器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-9-Rsyslog-%E5%90%8C%E6%97%B6%E8%BE%93%E5%87%BA%E7%9B%B8%E5%90%8C%E6%97%A5%E5%BF%97%E5%88%B0%E5%A4%9A%E4%B8%AA%E6%96%87%E4%BB%B6%E6%B5%8B%E8%AF%95-1%E3%80%90%E5%9F%BA%E4%BA%8E-facility-%E4%B8%8E-loglevel%E3%80%91"><span class="nav-text">9.9. Rsyslog 同时输出相同日志到多个文件测试 1【基于 facility 与 loglevel】</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-10-Rsyslog-%E5%90%8C%E6%97%B6%E8%BE%93%E5%87%BA%E7%9B%B8%E5%90%8C%E6%97%A5%E5%BF%97%E5%88%B0%E5%A4%9A%E4%B8%AA%E6%96%87%E4%BB%B6%E6%B5%8B%E8%AF%95-2%E3%80%90%E5%9F%BA%E4%BA%8E%E6%B6%88%E6%81%AF%E4%BD%93%E5%AD%97%E6%AE%B5%E5%86%85%E5%AE%B9%E3%80%91"><span class="nav-text">9.10. Rsyslog 同时输出相同日志到多个文件测试 2【基于消息体字段内容】</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-11-Rsyslog-%E9%85%8D%E7%BD%AE%E4%B8%AD%EF%BC%8C%E7%BB%88%E6%AD%A2%E5%90%8E%E7%BB%AD%E6%96%87%E4%BB%B6%E4%B8%AD%E7%BB%A7%E7%BB%AD%E5%8C%B9%E9%85%8D"><span class="nav-text">9.11. Rsyslog 配置中，终止后续文件中继续匹配</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-12-Rsyslog-%E4%B8%8D%E6%94%AF%E6%8C%81%E7%9B%B4%E6%8E%A5%E5%8F%98%E6%9B%B4-loglevel-%E5%8F%8A-facility-%E2%80%94%E2%80%94-%E6%B5%8B%E8%AF%95-Rsyslog-%E7%9B%B4%E6%8E%A5%E5%8F%98%E6%9B%B4-facility%E3%80%90%E5%A4%B1%E8%B4%A5%E3%80%91"><span class="nav-text">9.12. Rsyslog 不支持直接变更 loglevel 及 facility  —— 测试 Rsyslog 直接变更 facility【失败】</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-13-Rsyslog-%E5%BC%80%E5%90%AF%E8%B0%83%E8%AF%95"><span class="nav-text">9.13. Rsyslog 开启调试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-14-%E9%85%8D%E7%BD%AE-Rsyslog-%E5%90%AF%E5%8A%A8%EF%BC%88Mac%EF%BC%89"><span class="nav-text">9.14. 配置 Rsyslog 启动（Mac）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-15-sonic-mgmt"><span class="nav-text">9.15. sonic-mgmt</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-16-mgmt-topo-%E7%9B%B8%E5%85%B3-brctl-%E6%8C%87%E4%BB%A4"><span class="nav-text">9.16. mgmt-topo 相关 brctl 指令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-17-mgmt-topo-%E7%9B%B8%E5%85%B3-Open-vSwitch-%E6%8C%87%E4%BB%A4"><span class="nav-text">9.17. mgmt-topo 相关 Open vSwitch 指令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-18-mgmt-%E8%B0%83%E5%A4%A7-fanout-%E4%BE%A7%E5%AF%B9-lldp%E3%80%81lacp-%E5%8D%8F%E8%AE%AE%E7%9A%84%E4%B8%8A%E6%8A%A5%E9%99%90%E9%80%9F%E5%80%BC"><span class="nav-text">9.18. mgmt 调大 fanout 侧对 lldp、lacp 协议的上报限速值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-19-sonic-mgmt-VM-%E4%BA%92%E9%80%9A-%E9%85%8D%E7%BD%AE"><span class="nav-text">9.19. sonic-mgmt VM 互通 配置</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#10-%E7%BC%96%E8%AF%91"><span class="nav-text">10. 编译</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#10-1-%E6%89%8B%E5%8A%A8%E5%88%9B%E5%BB%BA-SONiC-%E7%BC%96%E8%AF%91%E5%AE%B9%E5%99%A8"><span class="nav-text">10.1. 手动创建 SONiC 编译容器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-2-%E5%85%A8%E9%87%8F%E7%BC%96%E8%AF%91%EF%BC%88%E5%8D%9A%E9%80%9A%EF%BC%89"><span class="nav-text">10.2. 全量编译（博通）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-3-%E5%85%A8%E9%87%8F%E7%BC%96%E8%AF%91%EF%BC%88Barefoot%EF%BC%89"><span class="nav-text">10.3. 全量编译（Barefoot）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-4-P4-SDE9-3-2-%E7%BC%96%E8%AF%91"><span class="nav-text">10.4. P4 SDE9.3.2 编译</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-5-%E7%BC%96%E8%AF%91%E6%94%AF%E6%8C%81-gdb"><span class="nav-text">10.5. 编译支持 gdb</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#11-%E6%8E%92%E9%9A%9C"><span class="nav-text">11. 排障</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#11-1-%E6%9F%A5%E7%9C%8B%E5%B9%B3%E5%8F%B0%E8%BD%AF%E4%BB%B6%E4%BF%A1%E6%81%AF"><span class="nav-text">11.1. 查看平台软件信息</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#11-1-1-%E6%9F%A5%E7%9C%8B-CPU-%E6%95%B0"><span class="nav-text">11.1.1. 查看 CPU 数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-1-2-%E6%9F%A5%E7%9C%8B%E5%86%85%E5%AD%98%E5%A4%A7%E5%B0%8F"><span class="nav-text">11.1.2. 查看内存大小</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-1-3-%E6%9F%A5%E7%9C%8B%E7%B3%BB%E7%BB%9F%E5%86%85%E5%AD%98%E5%A4%A7%E9%A1%B5%E9%85%8D%E7%BD%AE"><span class="nav-text">11.1.3. 查看系统内存大页配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-1-4-%E6%9F%A5%E7%9C%8B%E7%A3%81%E7%9B%98%E6%8C%82%E8%BD%BD-list-disks"><span class="nav-text">11.1.4. 查看磁盘挂载 list disks</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-2-%E6%9F%A5%E7%9C%8B%E5%B9%B3%E5%8F%B0%E7%A1%AC%E4%BB%B6%E4%BF%A1%E6%81%AF"><span class="nav-text">11.2. 查看平台硬件信息</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#11-2-1-%E5%B9%B3%E5%8F%B0%E4%BF%A1%E6%81%AF"><span class="nav-text">11.2.1. 平台信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-2-2-%E7%B3%BB%E7%BB%9F%E7%8A%B6%E6%80%81%E4%BF%A1%E6%81%AF"><span class="nav-text">11.2.2. 系统状态信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-2-3-%E6%9F%A5%E7%9C%8B-Tofino-%E8%8A%AF%E7%89%87%E6%98%AF%E5%90%A6%E8%83%BD%E8%A2%AB%E8%AF%86%E5%88%AB"><span class="nav-text">11.2.3. 查看 Tofino 芯片是否能被识别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-2-4-%E6%9F%A5%E7%9C%8BBIOS%E7%89%88%E6%9C%AC"><span class="nav-text">11.2.4. 查看BIOS版本</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-2-5-%E6%9F%A5%E7%9C%8B-eeprom-SN"><span class="nav-text">11.2.5. 查看 eeprom SN</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-2-6-%E6%9F%A5%E7%9C%8Bi2c%E8%AE%BE%E5%A4%87"><span class="nav-text">11.2.6. 查看i2c设备</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-2-7-i2c-%E5%AE%9A%E4%BD%8D%E6%8C%87%E4%BB%A4"><span class="nav-text">11.2.7. i2c 定位指令</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-3-%E6%9F%A5%E7%9C%8B%E6%8C%87%E5%AE%9A%E8%BF%9B%E7%A8%8B%E5%90%AF%E5%8A%A8%E5%8F%82%E6%95%B0"><span class="nav-text">11.3. 查看指定进程启动参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-4-sonic-cfggen-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="nav-text">11.4. sonic-cfggen 常用命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-5-%E6%9C%8D%E5%8A%A1%E5%AE%B9%E5%99%A8%E5%90%AF%E5%81%9C"><span class="nav-text">11.5. 服务容器启停</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-6-I2C-%E6%AD%BB%E9%94%81%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95"><span class="nav-text">11.6. I2C 死锁问题解决方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-7-Accton%E4%BA%A4%E6%8D%A2%E6%9C%BA%E6%97%A0%E6%B3%95%E6%89%BE%E5%88%B0cdc-ethernet%E7%AB%AF%E5%8F%A3%E4%BF%AE%E5%A4%8D%E6%96%B9%E6%B3%95"><span class="nav-text">11.7. Accton交换机无法找到cdc_ethernet端口修复方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-8-Accton-tofino-%E9%A9%B1%E5%8A%A8%E6%97%A0%E6%B3%95%E8%AF%86%E5%88%AB%E9%97%AE%E9%A2%98"><span class="nav-text">11.8. Accton tofino 驱动无法识别问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-9-Accton%E4%BA%A4%E6%8D%A2%E6%9C%BA%E6%9F%A5%E7%9C%8BBMC%E7%A1%AC%E4%BB%B6%E4%BF%A1%E6%81%AF"><span class="nav-text">11.9. Accton交换机查看BMC硬件信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-10-SONiC%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7"><span class="nav-text">11.10. SONiC版本升级</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-11-%E6%8E%92%E6%9F%A5%E7%AB%AF%E5%8F%A3%E6%8A%96%E5%8A%A8"><span class="nav-text">11.11. 排查端口抖动</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-12-%E6%B8%85%E9%9B%B6%E6%9F%90%E5%90%AF%E5%8A%A8%E5%A4%B1%E8%B4%A5-service-%E7%9A%84%E5%A4%B1%E8%B4%A5%E8%AE%A1%E6%95%B0"><span class="nav-text">11.12. 清零某启动失败 service 的失败计数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-13-%E9%80%9A%E8%BF%87sonic-cfggen%E8%8E%B7%E5%8F%96%E7%BD%91%E5%85%B3v6-IP"><span class="nav-text">11.13. 通过sonic-cfggen获取网关v6 IP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-14-ONIE-%E6%9F%A5%E7%9C%8B%E7%B3%BB%E7%BB%9F-efi-%E5%90%AF%E5%8A%A8%E9%A1%BA%E5%BA%8F"><span class="nav-text">11.14. ONIE 查看系统 efi 启动顺序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-15-gdb%E8%B0%83%E8%AF%95coredump%E6%96%87%E4%BB%B6"><span class="nav-text">11.15. gdb调试coredump文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-16-%E8%BF%87%E6%BB%A4-Err-%E6%97%A5%E5%BF%97"><span class="nav-text">11.16. 过滤 Err 日志</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-17-%E6%9F%A5%E7%9C%8B%E6%8C%87%E5%AE%9A%E6%97%B6%E9%97%B4%E6%AE%B5%E4%BF%AE%E6%94%B9%E8%BF%87-syslog-%E6%96%87%E4%BB%B6%E4%B8%AD%E7%89%B9%E5%AE%9A%E5%86%85%E5%AE%B9"><span class="nav-text">11.17. 查看指定时间段修改过 syslog 文件中特定内容</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-18-Logrotate"><span class="nav-text">11.18. Logrotate</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-19-%E7%B3%BB%E7%BB%9F%E5%86%85%E5%AD%98%E8%B6%85%E5%87%BA-OOM-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95"><span class="nav-text">11.19. 系统内存超出 OOM 解决方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-20-%E5%90%AF%E5%8A%A8%E5%8A%A0%E8%BD%BD%E6%96%87%E4%BB%B6"><span class="nav-text">11.20. 启动加载文件</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#12-%E5%85%B6%E4%BB%96"><span class="nav-text">12. 其他</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#12-1-%E9%85%8D%E7%BD%AE-Loopback-IP"><span class="nav-text">12.1. 配置 Loopback IP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-2-%E6%9B%B4%E6%94%B9-Hostname"><span class="nav-text">12.2. 更改 Hostname</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-3-%E4%BF%AE%E6%94%B9-Linux-%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E6%97%B6%E9%BB%98%E8%AE%A4shell"><span class="nav-text">12.3. 修改 Linux 用户登录时默认shell</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-4-%E4%B8%80%E8%A1%8C%E6%8C%87%E4%BB%A4%E4%BF%AE%E6%94%B9%E5%AF%86%E7%A0%81"><span class="nav-text">12.4. 一行指令修改密码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-5-%E9%80%9A%E8%BF%87-redis-key-%E5%AE%A3%E5%91%8A-x2F-%E6%92%A4%E9%94%80%E8%B7%AF%E7%94%B1"><span class="nav-text">12.5. 通过 redis key 宣告&#x2F;撤销路由</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-6-%E6%9F%A5%E7%9C%8B-config-db-json-%E4%B8%AD%E9%85%8D%E7%BD%AE%E7%9A%84-BGP-NETWORK"><span class="nav-text">12.6. 查看 config_db.json 中配置的 BGP_NETWORK</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-7-install-%E5%AF%B9%E6%AF%94-cp"><span class="nav-text">12.7. install 对比 cp</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-8-%E5%88%9B%E5%BB%BA%E4%B8%B4%E6%97%B6%E9%9A%8F%E6%9C%BA%E8%B7%AF%E5%BE%84"><span class="nav-text">12.8. 创建临时随机路径</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-9-%E6%9F%A5%E7%9C%8B-Linux-%E8%B4%A6%E6%88%B7-%E5%AF%86%E6%96%87%E5%AF%86%E7%A0%81%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-text">12.9. 查看 Linux 账户 密文密码字符串</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-10-%E7%BD%97%E5%88%97-service-%E6%9C%8D%E5%8A%A1"><span class="nav-text">12.10. 罗列 service 服务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-11-%E7%BD%97%E5%88%97%E5%86%85%E5%AD%98%E4%B8%AD%E5%B7%B2%E5%8A%A0%E8%BD%BD-units"><span class="nav-text">12.11. 罗列内存中已加载 units</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-12-%E5%AE%89%E8%A3%85-thrift-0-13-0-%E5%91%BD%E4%BB%A4"><span class="nav-text">12.12. 安装 thrift 0.13.0 命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-13-Mac%E7%94%B5%E8%84%91%E4%BD%BF%E7%94%A8%E4%B8%B2%E5%8F%A3"><span class="nav-text">12.13. Mac电脑使用串口</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-14-mac-%E4%B8%8B%E4%BD%BF%E7%94%A8-minicom"><span class="nav-text">12.14. mac 下使用 minicom</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="haoleeson"
      src="/images/my-avatar.png">
  <p class="site-author-name" itemprop="name">haoleeson</p>
  <div class="site-description" itemprop="description">记录成长，享受生活！</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">92</span>
          <span class="site-state-item-name">文章</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">主题</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">33</span>
        <span class="site-state-item-name">关键词</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/haoleeson" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;haoleeson" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Friendly links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://reuixiy.github.io/" title="https:&#x2F;&#x2F;reuixiy.github.io&#x2F;" rel="noopener" target="_blank">reuixiy</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://notes.iissnan.com/" title="https:&#x2F;&#x2F;notes.iissnan.com&#x2F;" rel="noopener" target="_blank">IIssNan</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://sunxiaohang.github.io/" title="https:&#x2F;&#x2F;sunxiaohang.github.io&#x2F;" rel="noopener" target="_blank">sunxiaohang</a>
        </li>
    </ul>
  </div>

          </div>
        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://haoleeson.cn/2024/01/20/SONICUsefullCmd/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/my-avatar.png">
      <meta itemprop="name" content="haoleeson">
      <meta itemprop="description" content="记录成长，享受生活！">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Haoleeson's Notes">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          SONiC常用命令
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">编写</span>

      <time title="创建：2024-01-20 22:30:45" itemprop="dateCreated datePublished" datetime="2024-01-20T22:30:45+08:00">2024-01-20</time>
    </span>

  
    <span id="/2024/01/20/SONICUsefullCmd/" class="post-meta-item leancloud_visitors" data-flag-title="SONiC常用命令" title="浏览">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">浏览：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>SONiC作为著名的白盒交换机操作系统，其容器化架构为白盒场景提供了的极大灵活性，及活跃卓越的社区环境，在业内自研交换机领域被广泛使用，本文记录SONiC一些工作中常用的配置与排障相关指令。</p>
<a id="more"></a>

<h1 id="1-端口"><a href="#1-端口" class="headerlink" title="1. 端口"></a>1. 端口</h1><h2 id="1-1-查看端口状态"><a href="#1-1-查看端口状态" class="headerlink" title="1.1. 查看端口状态"></a>1.1. 查看端口状态</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看端口状态</span></span><br><span class="line">show interfaces status</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看端口统计 出入包、错包统计、速率</span></span><br><span class="line">show interfaces counters -p 60</span><br></pre></td></tr></table></figure>

<h2 id="1-2-端口up-x2F-down"><a href="#1-2-端口up-x2F-down" class="headerlink" title="1.2. 端口up&#x2F;down"></a>1.2. 端口up&#x2F;down</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> DOWN 端口</span></span><br><span class="line">sudo config interface shutdown Ethernet14</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> DOWN 多端口（201911 无效）</span></span><br><span class="line">sudo config interface shutdown Ethernet13,Ethernet16-20,Ethernet32</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> UP 端口</span></span><br><span class="line">sudo config interface startup Ethernet1</span><br><span class="line">sudo config interface startup Ethernet33-35</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> UP 多端口（201911 无效）</span></span><br><span class="line">sudo config interface startup Ethernet33,Ethernet34-35</span><br></pre></td></tr></table></figure>

<h2 id="1-3-添加三层IP"><a href="#1-3-添加三层IP" class="headerlink" title="1.3. 添加三层IP"></a>1.3. 添加三层IP</h2><ul>
<li><p>方法1：<strong>修改配置文件</strong>(&#x2F;etc&#x2F;sonic&#x2F;config_db.json)<br>检查：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -A 10 MGMT_INTERFACE  /etc/sonic/config_db.json</span><br></pre></td></tr></table></figure>
<p>配置：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&quot;MGMT_INTERFACE&quot;: &#123;</span><br><span class="line">    &quot;eth0|10.32.124.119/24&quot;: &#123;</span><br><span class="line">        &quot;gwaddr&quot;: &quot;10.32.124.1&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;eth0|FC00:2::32/64&quot;: &#123;</span><br><span class="line">        &quot;gwaddr&quot;: &quot;fc00:2::1&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
</li>
<li><p>方法2：命令行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 为端口添加三层 IP</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#  - config interface ip add &lt;interface_name&gt; &lt;ip_addr&gt;</span></span></span><br><span class="line">sudo config interface ip add Ethernet2 10.0.0.5/24</span><br><span class="line">sudo config interface ip add Ethernet3 20.0.0.5/24</span><br><span class="line">sudo config interface ip add Ethernet63 10.11.12.13/24</span><br><span class="line">sudo config interface ip add eth0 20.11.12.13/24 20.11.12.254</span><br><span class="line">sudo config interface ip add eth0 10.32.124.119/24 10.32.124.1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加 IP</span></span><br><span class="line">sudo ip addr add fdbd:ff1:ce00:14::129/128 dev eth0</span><br><span class="line">sudo ip addr del fdbd:ff1:ce00:14::129/128 dev eth0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除三层 IP</span></span><br><span class="line">sudo config interface ip remove Ethernet2 10.0.0.5/24</span><br><span class="line">sudo config interface ip remove Ethernet3 10.0.0.4/31</span><br><span class="line">sudo config interface ip remove Ethernet8 20.0.0.1/24</span><br><span class="line">sudo config interface ip remove Ethernet4 10.0.0.1/24</span><br></pre></td></tr></table></figure>
</li>
<li><p>方法3：cli 配置管理 IP</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cli</span><br><span class="line"><span class="meta">sonic&gt;</span><span class="bash"> configure terminal</span></span><br><span class="line"><span class="meta">sonic(config)#</span><span class="bash"> interface-config</span></span><br><span class="line">sonic(interface config)# management</span><br><span class="line">sonic(interface mgmt)# ipv4-family</span><br><span class="line">sonic(interface mgmt v4)# address 192.168.3.35/24</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="1-4-聚合链路"><a href="#1-4-聚合链路" class="headerlink" title="1.4. 聚合链路"></a>1.4. 聚合链路</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看</span></span><br><span class="line">show interfaces portchannel</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建/删除 聚合链路</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#  - config portchannel (add | del) &lt;portchannel_name&gt; [--min-links &lt;num_min_links&gt;] [--fallback (true | false)  [--fast-rate (true | false)]</span></span></span><br><span class="line">sudo config portchannel add PortChannel0011</span><br><span class="line">sudo config portchannel del PortChannel0011</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 聚合链路 添加/移除 成员端口</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#  - config portchannel member (add | del) &lt;portchannel_name&gt; &lt;member_portname&gt;</span></span></span><br><span class="line">sudo config portchannel member add PortChannel0011 Ethernet13</span><br><span class="line">sudo config portchannel member del PortChannel0011 Ethernet13</span><br></pre></td></tr></table></figure>

<h2 id="1-5-VLAN"><a href="#1-5-VLAN" class="headerlink" title="1.5. VLAN"></a>1.5. VLAN</h2><p><strong>命令行方式</strong>：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看</span></span><br><span class="line">show vlan brief</span><br><span class="line">show vlan config</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加删除 VLAN</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#  - config vlan (add | del) &lt;vlan_id&gt;</span></span></span><br><span class="line">sudo config vlan add 100</span><br><span class="line">sudo config vlan del 100</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加删除 VLAN 成员端口</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#  - config vlan member add/del [-u|--untagged] &lt;vlan_id&gt; &lt;member_portname&gt;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## （带 tag）</span></span></span><br><span class="line">sudo config vlan member add 100 Ethernet13</span><br><span class="line">sudo config vlan member del 100 Ethernet13</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## （不带 tag）</span></span></span><br><span class="line">sudo config vlan member add -u 100 Ethernet14</span><br><span class="line">sudo config vlan member del 100 Ethernet14</span><br></pre></td></tr></table></figure>

<p><strong>cli方式</strong>：<br>eg. cli 配置 3.57 设备上直连端口 55 的三层 IP</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看物理端口（all / 端口 55）</span></span><br><span class="line">/usr/bin/cli -c &#x27;show interfaces status ethernet 63&#x27;</span><br><span class="line">/usr/bin/cli -c &#x27;show interfaces status ethernet 32&#x27;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看已配置 VLAN 信息</span></span><br><span class="line">/usr/bin/cli -c &#x27;show vlan brief&#x27;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看设备当前三层接口状态</span></span><br><span class="line">/usr/bin/cli -c &#x27;show ip interfaces&#x27;</span><br><span class="line"></span><br><span class="line">cli</span><br><span class="line">configure terminal</span><br><span class="line">vlan-config         # 进入 vlan 视图</span><br><span class="line">vlan 1055           # 创建 vlan 1055</span><br><span class="line">member port 55      # 将 55 端口添加到此 vlan（此 55 已配在 Portchannle 4）</span><br><span class="line">member portchannel 4 # 或将 Portchannel4 添加到此 vlan（此 Portchannel 4 已配在 vlan60）</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 切换到 interface 视图</span></span><br><span class="line">SONiC(vlan member)# exit</span><br><span class="line"><span class="meta">SONiC(vlan)#</span><span class="bash"> <span class="built_in">exit</span></span></span><br><span class="line">SONiC(vlan config)# exit</span><br><span class="line"><span class="meta">SONiC(config)#</span><span class="bash"> interface-config</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建三层接口并进入 vlan-interface 视图</span></span><br><span class="line">SONiC(interface config)# vlan-interface &lt;1-4094&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 配置 ipv4/ipv6 地址</span></span><br><span class="line">SONiC(interface vlanif)# ipv4-family</span><br><span class="line">SONiC(interface vlanif v4)# address X.X.X.X/M</span><br><span class="line">SONiC(interface vlanif)# ipv6-family</span><br><span class="line">SONiC(interface vlanif v6)# address X:X::X:X/M</span><br></pre></td></tr></table></figure>

<p><strong>删除VLAN</strong>：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cli</span><br><span class="line">configure terminal</span><br><span class="line"><span class="meta">SONiC(config)#</span><span class="bash"> interface-config</span></span><br><span class="line">sonic(interface config)# no vlan-interface 101</span><br><span class="line">sonic(interface config)# exit</span><br><span class="line"><span class="meta">sonic(config)#</span><span class="bash"> vlan-config</span></span><br><span class="line">sonic(vlan config)# no vlan 101</span><br></pre></td></tr></table></figure>

<h2 id="1-6-光模块"><a href="#1-6-光模块" class="headerlink" title="1.6. 光模块"></a>1.6. 光模块</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 显示光模块 eeprom 信息</span></span><br><span class="line">sudo sfputil show eeprom</span><br><span class="line">show interfaces transceiver eeprom</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 光模块-在位状态</span></span><br><span class="line">sudo sfputil show presence</span><br><span class="line">show interfaces transceiver presence</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 光模块-低功耗模式</span></span><br><span class="line">sudo sfputil show lpmode</span><br><span class="line">show interfaces transceiver lpmode</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看特定模块</span></span><br><span class="line">show interfaces transceiver eeprom --dom Ethernet1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 开启光模块低功耗模式 sfputil lpmode &lt;端口&gt;</span></span><br><span class="line">sudo sfputil lpmode Ethernet12</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 复位光模块 sfputil reset &lt;端口&gt;</span></span><br><span class="line">sudo sfputil reset Ethernet1</span><br></pre></td></tr></table></figure>

<h2 id="1-7-查看端口配置文件"><a href="#1-7-查看端口配置文件" class="headerlink" title="1.7. 查看端口配置文件"></a>1.7. 查看端口配置文件</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> x86_64-accton_wedge100bf_65x-r0</span></span><br><span class="line">cat /usr/share/sonic/device/x86_64-accton_wedge100bf_65x-r0/mavericks/port_config.ini</span><br><span class="line"><span class="meta">#</span><span class="bash"> XLT</span></span><br><span class="line">cat /usr/share/sonic/device/x86_64-accton_csp7551-r0/Accton-CSP7551/port_config.ini</span><br><span class="line"><span class="meta">#</span><span class="bash"> 恒扬</span></span><br><span class="line">cat /usr/share/sonic/device/x86_64-semptian_ps7350_32x-r0/SEMPTIAN-PS7350-32X/port_config.ini</span><br></pre></td></tr></table></figure>

<h1 id="2-常用-cli-命令"><a href="#2-常用-cli-命令" class="headerlink" title="2. 常用 cli 命令"></a>2. 常用 cli 命令</h1><h2 id="2-1-从-cli-进入-Linux-shell"><a href="#2-1-从-cli-进入-Linux-shell" class="headerlink" title="2.1. 从 cli 进入 Linux shell"></a>2.1. 从 cli 进入 Linux shell</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">start shell bash</span><br></pre></td></tr></table></figure>

<h2 id="2-2-bcmsh-下执行脚本模拟端口震荡"><a href="#2-2-bcmsh-下执行脚本模拟端口震荡" class="headerlink" title="2.2. bcmsh 下执行脚本模拟端口震荡"></a>2.2. bcmsh 下执行脚本模拟端口震荡</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> bcmsh 下执行脚本模拟端口震荡</span></span><br><span class="line">for i=0,1000 &#x27;port ce en=0; sleep 2; port xe en=1; sleep 8&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="2-3-常用-cli-命令"><a href="#2-3-常用-cli-命令" class="headerlink" title="2.3. 常用 cli 命令"></a>2.3. 常用 cli 命令</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看设备当前三层接口状态</span></span><br><span class="line">/usr/bin/cli -c &#x27;show ip interfaces&#x27;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看端口简要状态信息（all / 端口 55）</span></span><br><span class="line">/usr/bin/cli -c &#x27;show interfaces status&#x27;</span><br><span class="line">/usr/bin/cli -c &#x27;show interfaces status ethernet 1&#x27;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看 portchannle 信息</span></span><br><span class="line">/usr/bin/cli -c &#x27;show interfaces portchannel&#x27;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看已配置 VLAN 信息</span></span><br><span class="line">/usr/bin/cli -c &#x27;show vlan brief&#x27;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看交换机 AAA 配置</span></span><br><span class="line">/usr/bin/cli -c &#x27;show system-config aaa&#x27;</span><br><span class="line">/usr/bin/cli -c &#x27;show system-config tacacs&#x27;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看端口详细统计信息</span></span><br><span class="line">/usr/bin/cli -c &#x27;show interfaces detail ethernet 1&#x27;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看端口计数信息</span></span><br><span class="line">/usr/bin/cli -c &#x27;show interfaces counters&#x27;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看 bgp 信息</span></span><br><span class="line">/usr/bin/cli -c &#x27;show bgp summary&#x27;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看 bgp 路由信息</span></span><br><span class="line">/usr/bin/cli -c &#x27;show route ipv6 bgp&#x27;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> cli 查看端口统计</span></span><br><span class="line">/usr/bin/cli -c &#x27;show interfaces brief&#x27;</span><br><span class="line">/usr/bin/cli -c &#x27;show interfaces detail ethernet 55&#x27;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> cli 清零端口统计计数</span></span><br><span class="line">/usr/bin/cli -c &#x27;clear interface statistics port 55&#x27;</span><br></pre></td></tr></table></figure>

<h1 id="3-路由"><a href="#3-路由" class="headerlink" title="3. 路由"></a>3. 路由</h1><h2 id="3-1-增删路由"><a href="#3-1-增删路由" class="headerlink" title="3.1. 增删路由"></a>3.1. 增删路由</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> add</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> config route add prefix &lt;A.B.C.D/M&gt; nexthop &lt;dev &lt;dev_name&gt;&gt;</span></span><br><span class="line">sudo config route add prefix 10.32.124.0/24 nexthop dev eth0</span><br><span class="line">sudo config route add prefix 10.32.124.0/24 nexthop dev management0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> del</span></span><br><span class="line">sudo config route del prefix 10.32.124.0/24 nexthop dev eth0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加路由</span></span><br><span class="line">sudo ip route add 10.0.0.0/24 dev eth0</span><br><span class="line">sudo ip route add 20.0.0.2 dev Ethernet8</span><br><span class="line">sudo ip route add 20.0.0.2/24 via 10.201.40.80 dev eth0</span><br><span class="line">sudo ip route add 20.0.0.2 dev Ethernet8 scope link protocol kernel src 10.0.0.5</span><br><span class="line">sudo ip route add 20.0.0.1 scope link protocol kernel src 10.0.0.5</span><br><span class="line"></span><br><span class="line">sudo ip route add 20.0.0.5 via 10.0.0.5 dev Ethernet4</span><br><span class="line"></span><br><span class="line">sudo ip route add 20.0.0.5 dev Ethernet4 scope link protocol kernel src 10.0.0.5</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除</span></span><br><span class="line">ip route del 10.201.40.0/24 via 10.201.40.65</span><br><span class="line">ip route del 10.201.40.0/24 via 10.201.40.69 10.201.40.65</span><br><span class="line"></span><br><span class="line">ip route del 10.201.40.0/24 via 10.201.40.65</span><br><span class="line">ip route del 10.201.40.0/24 via 10.201.40.65 dev eth0</span><br></pre></td></tr></table></figure>

<h2 id="3-2-查看arp表"><a href="#3-2-查看arp表" class="headerlink" title="3.2. 查看arp表"></a>3.2. 查看arp表</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看 arp 表</span></span><br><span class="line">sudo arp -vn | grep &#x27;&#x27;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 或</span></span><br><span class="line">sudo arp -n</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除指定 ip 的 arp 表项</span></span><br><span class="line">arp -d 192.168.0.8</span><br><span class="line"></span><br><span class="line">arp -s &lt;host&gt; &lt;hwaddr&gt;</span><br><span class="line">arp -s 10.0.0.33 660102030405</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 清除指定 interface 的 arp</span></span><br><span class="line">sudo ip link set arp off dev Ethernet2; sudo ip link set arp on dev Ethernet2</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 刷新所有记录的 arp 表项</span></span><br><span class="line">ip -s -s neigh flush all</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 删除所有 arp 表项</span></span></span><br><span class="line">arp -d -a</span><br></pre></td></tr></table></figure>

<h1 id="4-BGP"><a href="#4-BGP" class="headerlink" title="4. BGP"></a>4. BGP</h1><h2 id="4-1-配置-BGP-邻居"><a href="#4-1-配置-BGP-邻居" class="headerlink" title="4.1. 配置 BGP 邻居"></a>4.1. 配置 BGP 邻居</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">configure terminal</span><br><span class="line">    router bgp &lt;唯一 AS 号&gt;                      # 进入 bgp 视图</span><br><span class="line">    bgp router-id &lt;本地环回地址&gt;                # 配置环回地址作为 route-id</span><br><span class="line">    bgp fast-external-failover                # 使能 fast-external-failover</span><br><span class="line">    bgp network import-check                  # 开启 network 路由检查</span><br><span class="line">    bgp graceful-restart                      # 启用 graceful-restart</span><br><span class="line">    # bgp bestpath as-path multipath-relax    # 使能 ecmp</span><br><span class="line">    # bgp always-compare-med                  # 启用 always-compare-med</span><br><span class="line"></span><br><span class="line">    address-family ipv4</span><br><span class="line">        maximum-paths 64                  # 设置 ipv4 ecmp 最大路径数量</span><br><span class="line">        network &lt;本地环回地址&gt;/32           # 发布 v4 路由（宣告本地环回地址）</span><br><span class="line">        redistribute kernel	              # 重分发 kernel 路由</span><br><span class="line">    exit-address-family</span><br><span class="line"></span><br><span class="line">    # 添加 BGP 邻居</span><br><span class="line">    neighbor &lt;邻居端直连端口的三层 IP&gt; remote-as &lt;邻居唯一 AS 号&gt;</span><br><span class="line">    # 激活邻居</span><br><span class="line">    address-family ipv4</span><br><span class="line">        neighbor &lt;邻居端直连端口的三层 IP&gt; activate</span><br><span class="line">    exit-address-family</span><br></pre></td></tr></table></figure>

<h2 id="4-2-停止-x2F-打开BGP邻居"><a href="#4-2-停止-x2F-打开BGP邻居" class="headerlink" title="4.2. 停止&#x2F;打开BGP邻居"></a>4.2. 停止&#x2F;打开BGP邻居</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 停止/打开 所有 BGP Neighbor 链路（发 ADMIN_SHUTDOWN notify）</span></span><br><span class="line">sudo config bgp shutdown all</span><br><span class="line">sudo config bgp startup all</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 停止/打开 某一 BGP Neighbor 链路</span></span><br><span class="line">sudo config bgp shutdown neighbor 10.0.0.37</span><br><span class="line">sudo config bgp startup neighbor 10.0.0.37</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 通过改 redis 表项停止/打开 某一BGP Neighbor 链路</span></span><br><span class="line">redis-cli -h 127.0.0.1 -n 4 -p 6379 HSET &quot;BGP_NEIGHBOR|10.0.0.57&quot; &#x27;admin_status&#x27; &#x27;down&#x27;</span><br><span class="line">redis-cli -h 127.0.0.1 -n 4 -p 6379 HSET &quot;BGP_NEIGHBOR|10.0.0.57&quot; &#x27;admin_status&#x27; &#x27;up&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="4-3-查看-BGP-宣告网段"><a href="#4-3-查看-BGP-宣告网段" class="headerlink" title="4.3. 查看 BGP 宣告网段"></a>4.3. 查看 BGP 宣告网段</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> vtysh -c <span class="string">&#x27;show run&#x27;</span> | grep network | cut -d \  -f4</span></span><br><span class="line">vtysh -c &#x27;show running bgpd&#x27; | grep network</span><br></pre></td></tr></table></figure>

<h2 id="4-4-查看-bgp-指定邻居宣告路由"><a href="#4-4-查看-bgp-指定邻居宣告路由" class="headerlink" title="4.4. 查看 bgp 指定邻居宣告路由"></a>4.4. 查看 bgp 指定邻居宣告路由</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vtysh -c &#x27;show bgp ipv4 neighbors 100.106.105.228 advertised-routes&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="4-5-redis-获取-BGP-Neighbor-建链状态"><a href="#4-5-redis-获取-BGP-Neighbor-建链状态" class="headerlink" title="4.5. redis 获取 BGP Neighbor 建链状态"></a>4.5. redis 获取 BGP Neighbor 建链状态</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> p4gw201911</span></span><br><span class="line">redis-cli -h 127.0.0.1 -n 6 -p 6379 hget &quot;NEIGH_STATE_TABLE|100.106.222.215&quot; &quot;state&quot;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> lambda</span></span><br><span class="line">redis-cli -h 127.0.0.1 -n 6 -p 6379 hget &quot;BGP_PEER|30.1.1.1&quot; &quot;state&quot;</span><br></pre></td></tr></table></figure>

<h1 id="5-vtysh"><a href="#5-vtysh" class="headerlink" title="5. vtysh"></a>5. vtysh</h1><h2 id="5-1-查看配置"><a href="#5-1-查看配置" class="headerlink" title="5.1. 查看配置"></a>5.1. 查看配置</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看 interface 信息</span></span><br><span class="line">/usr/bin/vtysh -c &#x27;show interface brief&#x27;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看日志配置</span></span><br><span class="line">/usr/bin/vtysh -c &#x27;show rsyslog configuration&#x27;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看 当前 BGP 运行配置</span></span><br><span class="line">vtysh -c &#x27;show running-config&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="5-2-通过-route-map-过滤路由"><a href="#5-2-通过-route-map-过滤路由" class="headerlink" title="5.2. 通过 route-map 过滤路由"></a>5.2. 通过 route-map 过滤路由</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">vtysh</span><br><span class="line">configure terminal</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建拒收网段的 ip prefix-list</span></span><br><span class="line">ip prefix-list V4_BGP_IN_FILTER_PFXLIST seq 1001 deny 3.1.1.1/32</span><br><span class="line">ip prefix-list V4_BGP_IN_FILTER_PFXLIST seq 1002 deny 3.3.3.3/32</span><br><span class="line">ip prefix-list V4_BGP_IN_FILTER_PFXLIST seq 9999 permit 0.0.0.0/0 le 32</span><br><span class="line"><span class="meta">#</span><span class="bash"> check</span></span><br><span class="line">do show ip prefix-list V4_BGP_IN_FILTER_PFXLIST</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建拒收 v4 路由的 route-map 规则 （注：route-map 默认 Matching Policy 是 deny）</span></span><br><span class="line">route-map V4_BGP_IN_FILTER_ROUTEMAP permit 5</span><br><span class="line">    match ip address prefix-list V4_BGP_IN_FILTER_PFXLIST</span><br><span class="line">    set community 5060:12345 additive</span><br><span class="line">    # check</span><br><span class="line">    do show route-map V4_BGP_IN_FILTER_ROUTEMAP</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将 Route MAP 应用到所有 neighbor</span></span><br><span class="line">router bgp 65000</span><br><span class="line">    address-family ipv4 unicast</span><br><span class="line">    neighbor 172.31.251.190 route-map V4_BGP_IN_FILTER_ROUTEMAP in</span><br><span class="line">    neighbor 172.31.251.192 route-map V4_BGP_IN_FILTER_ROUTEMAP in</span><br><span class="line">    exit-address-family</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> check route filter</span></span><br><span class="line">do show ip bgp neighbor 172.31.251.190 advertised-routes</span><br></pre></td></tr></table></figure>

<h2 id="5-3-添加bgp-peer"><a href="#5-3-添加bgp-peer" class="headerlink" title="5.3. 添加bgp peer"></a>5.3. 添加bgp peer</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">vtysh</span><br><span class="line">configure terminal</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> add prefix-list 注意区分 ip/ipv6</span></span><br><span class="line">ipv6 prefix-list FROM_SW_V6 seq 10 permit any</span><br><span class="line">ipv6 prefix-list TO_SW_V6 seq 10 permit any</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> add BGP peer</span></span><br><span class="line">router bgp 64512</span><br><span class="line">neighbor fdbd:dc00:46::646a:b67c remote-as 64751</span><br><span class="line">address-family ipv6</span><br><span class="line">neighbor fdbd:dc00:46::646a:b67c prefix-list FROM_SW_V6 in</span><br><span class="line">neighbor fdbd:dc00:46::646a:b67c prefix-list TO_SW_V6 out</span><br><span class="line">neighbor fdbd:dc00:46::646a:b67c activate</span><br><span class="line"><span class="meta">#</span><span class="bash"> 多条链接时需指定最大链接数, server-2 (10.11.112.33)</span></span><br><span class="line">neighbor fdbd:dc00:46::646a:b67c ebgp-multihop 3</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> (opt) announce network 需在 v4 | v6 address-family 下</span></span><br><span class="line">address-family ipv6</span><br><span class="line">network fdbd:dcfd:0:999::3/128</span><br><span class="line">address-family ipv4</span><br><span class="line">network 192.168.1.2/32</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> check</span></span><br><span class="line">do show ip prefix-list</span><br><span class="line">do show ipv6 prefix-list</span><br><span class="line">do show bgp neighbors fdbd:dc00:46::646a:b67c</span><br><span class="line">do show bgp summary</span><br></pre></td></tr></table></figure>

<h2 id="5-4-宣告路由"><a href="#5-4-宣告路由" class="headerlink" title="5.4. 宣告路由"></a>5.4. 宣告路由</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">vtysh</span><br><span class="line">configure terminal</span><br><span class="line"><span class="meta">#</span><span class="bash"> 需：本机手工加待宣告 v4 网段的黑洞路由 （在 config 视图下操作）</span></span><br><span class="line">ipv4 route-static 172.20.0.0/16 blackhole</span><br><span class="line">ipv4 route-static 172.21.0.0/16 blackhole</span><br><span class="line"><span class="meta">#</span><span class="bash"> 需：本机手工加待宣告 v6 网段的黑洞路由 （在 config 视图下操作）</span></span><br><span class="line">ipv6 route-static fd01::/64 blackhole</span><br><span class="line">ipv6 route-static fd02::/64 blackhole</span><br><span class="line"></span><br><span class="line">router bgp 65000</span><br><span class="line"><span class="meta">#</span><span class="bash"> 允许免检查宣告网段</span></span><br><span class="line">no bgp network import-check</span><br><span class="line"></span><br><span class="line">neighbor 172.31.252.71 peer-group A00T2_4</span><br><span class="line">neighbor 172.31.252.75 peer-group A00T2_4</span><br><span class="line">neighbor 172.31.252.79 peer-group A00T2_4</span><br><span class="line">neighbor 172.31.252.83 peer-group A00T2_4</span><br><span class="line">neighbor fdbd:dc00:46::ac1f:fc47 peer-group A00T2_6</span><br><span class="line">neighbor fdbd:dc00:46::ac1f:fc4b peer-group A00T2_6</span><br><span class="line">neighbor fdbd:dc00:46::ac1f:fc4f peer-group A00T2_6</span><br><span class="line">neighbor fdbd:dc00:46::ac1f:fc53 peer-group A00T2_6</span><br><span class="line"></span><br><span class="line">do show ip bgp peer-group A00T2_4</span><br><span class="line">do show ip bgp peer-group A00T2_6</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看指定邻居 宣告路由</span></span><br><span class="line">do show ip bgp neighbor 172.31.252.71 advertised-routes</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看指定邻居 收到路由</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 不支持 <span class="keyword">do</span> show ip bgp neighbor 172.31.252.71 received-routes</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 宣告路由（注：network 只宣告本机路由表已有的网段，若没有则不会宣告）</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> vtysh</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> configure terminal</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> address-family ipv4 unicast</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 本机 loopback1，已有路由表</span></span><br><span class="line">network 10.8.104.254/32</span><br><span class="line">network 172.20.0.0/16</span><br><span class="line">network 172.21.0.0/16</span><br><span class="line"></span><br><span class="line">network 3.10.0.1/32</span><br><span class="line">network 3.10.0.14/32</span><br><span class="line">network 10.32.125.114/32</span><br><span class="line"><span class="meta">#</span><span class="bash"> exit-address-family</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> address-family ipv6 unicast</span></span><br><span class="line">network fd03::1/128</span><br><span class="line">network fd01::/64</span><br><span class="line">network fd02::/64</span><br><span class="line"><span class="meta">#</span><span class="bash"> exit-address-family</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> check 指定宣告路由情况</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> lambda-cli</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> configure terminal</span></span><br><span class="line">do show ip bgp network 3.10.0.1/32</span><br><span class="line">do show ip bgp network 3.10.0.14/32</span><br><span class="line">do show ip bgp network 10.32.125.114/32</span><br><span class="line">do show ip bgp network 10.8.104.254/32</span><br><span class="line">do show ip bgp network 172.20.0.0/16</span><br><span class="line">do show ip bgp network 172.21.0.0/16</span><br><span class="line">do show ip bgp network fd03::1/128</span><br><span class="line">do show ip bgp network fd01::/64</span><br><span class="line">do show ip bgp network fd02::/64</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<h2 id="5-5-添加路由"><a href="#5-5-添加路由" class="headerlink" title="5.5. 添加路由"></a>5.5. 添加路由</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vtysh</span><br><span class="line">configure terminal</span><br><span class="line">ip route 20.0.0.2 255.255.255.0 20.0.0.1</span><br><span class="line">do show ip route</span><br></pre></td></tr></table></figure>

<h2 id="5-6-vrf-命令"><a href="#5-6-vrf-命令" class="headerlink" title="5.6. vrf 命令"></a>5.6. vrf 命令</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看 vrf 有哪些接口</span></span><br><span class="line">show vrf vrf36012</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看 vrf bgp</span></span><br><span class="line">vtysh -c &#x27;show bgp vrf vrf36012 summary&#x27;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看 bfd 信息</span></span><br><span class="line">vtysh -c &#x27;show bfd peers brief&#x27;</span><br><span class="line">vtysh -c &#x27;show bfd vrf vrf36012 peers brief&#x27;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看所有 vrf 路由</span></span><br><span class="line">vtysh -c &#x27;show ip route vrf all json&#x27;</span><br><span class="line">vtysh -c &#x27;show ipv6 route vrf all json&#x27;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看指定 vrf 邻居</span></span><br><span class="line">vtysh -c &#x27;show bgp vrf vrf36012 ipv4&#x27;</span><br><span class="line">vtysh -c &#x27;show bgp vrf vrf36012 ipv4 summary&#x27;</span><br><span class="line">vtysh -c &#x27;show bgp vrf vrf36012 ipv4 json&#x27;</span><br><span class="line">vtysh -c &#x27;show bgp vrf vrf36012 ipv6&#x27;</span><br><span class="line">vtysh -c &#x27;show bgp vrf vrf36012 ipv6 summary&#x27;</span><br><span class="line">vtysh -c &#x27;show bgp vrf vrf36012 ipv6 json&#x27;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看指定 vrf 邻居简要信息</span></span><br><span class="line">vtysh -c &#x27;show bfd vrf vrf36012 peers brief&#x27;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看指定 vrf 邻居接收到或宣告的路由信息</span></span><br><span class="line">vtysh -c &#x27;show bgp vrf vrf36012 neighbors 3001:100::1 received-routes&#x27;</span><br><span class="line">vtysh -c &#x27;show bgp vrf vrf36012 neighbors 3001:100::1 advertised-routes&#x27;</span><br><span class="line">vtysh -c &#x27;show bgp vrf vrf36012 neighbors 3001:100::1 received-routes json&#x27;</span><br><span class="line">vtysh -c &#x27;show bgp vrf vrf36012 neighbors 3001:100::1 advertised-routes json&#x27;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看指定 vrf 路由</span></span><br><span class="line">vtysh -c &#x27;show bgp vrf vrf36012 ipv4 cidr-only wide&#x27;</span><br><span class="line">vtysh -c &#x27;show bgp vrf vrf36012 ipv4 cidr-only json&#x27;</span><br><span class="line">vtysh -c &#x27;show bgp vrf vrf36012 ipv4 json&#x27;</span><br><span class="line">vtysh -c &#x27;show bgp vrf vrf36012 ipv4&#x27;</span><br><span class="line">vtysh -c &#x27;show bgp vrf vrf36012 ipv6 cidr-only wide&#x27;</span><br><span class="line">vtysh -c &#x27;show bgp vrf vrf36012 ipv6 cidr-only json&#x27;</span><br><span class="line">vtysh -c &#x27;show bgp vrf vrf36012 ipv6 json&#x27;</span><br><span class="line">vtysh -c &#x27;show bgp vrf vrf36012 ipv6&#x27;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看指定 evpn vni instance 信息</span></span><br><span class="line">vtysh -c &#x27;show evpn vni 36013&#x27;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看 vrf arp 信息</span></span><br><span class="line">vtysh -c &#x27;show evpn arp-cache vni 36012&#x27;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看指定 vrf 指定邻居  宣告路由</span></span><br><span class="line">vtysh -c &#x27;show bgp vrf vrf36012 neighbors 3001:100::1 advertised-routes json&#x27;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看指定 vrf 指定邻居  收到路由</span></span><br><span class="line">vtysh -c &#x27;show bgp vrf vrf36012 neighbors 3001:100::1 received-routes json&#x27;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看 bfd 简信</span></span><br><span class="line">show bfd summary</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Vrf ping</span></span><br><span class="line">timeout 1 ping -4 -I vrf36012 -c 3 -i 0.2 30.1.2.1</span><br><span class="line">timeout 1 ping -6 -I vrf36012 -c 3 -i 0.2 3001:100::1</span><br></pre></td></tr></table></figure>

<h1 id="6-BMC"><a href="#6-BMC" class="headerlink" title="6. BMC"></a>6. BMC</h1><h2 id="6-1-Accton-设备串口-切换-BMC-x2F-COME"><a href="#6-1-Accton-设备串口-切换-BMC-x2F-COME" class="headerlink" title="6.1. Accton 设备串口 切换 BMC&#x2F;COME"></a>6.1. Accton 设备串口 切换 BMC&#x2F;COME</h2><blockquote>
<p>串口服务器登录账号密码：admin\Admin123!@#</p>
</blockquote>
<blockquote>
<p>65x: 9600&#x2F;8N1<br>xlt: 115200&#x2F;8N1</p>
</blockquote>
<p>方法 1：CTRL + U 快捷键</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> （将串口访问的）BMC 切 COME</span></span><br><span class="line">按下 CTRL + U 后（1~2秒）松开，按数字 1，再按回车</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> （将串口访问的）COME 切 BMC</span></span><br><span class="line">按下 CTRL + U 后（1~2秒）松开，按数字 2，再按回车</span><br></pre></td></tr></table></figure>

<p>方法 2：sol.sh</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> （将串口访问的）BMC 切 COME</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 执行 sol.sh，按数字 1，回车</span></span><br><span class="line">/usr/local/bin/sol.sh</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> （将串口访问的）COME 切 BMC</span></span><br><span class="line">长按 CTRL + X ; 或键入英文下的 ~. (若无反应再试一次就行)</span><br></pre></td></tr></table></figure>

<p>注意: 若在 BMC sol.sh 进入 COME，则需按快捷键 ~. 回车重返 BMC，此时<strong>CTRL + U 快捷键无法返回 BMC</strong></p>
<h2 id="6-2-Accton-通过-usb0-口-SSH-访问-OpenBMC"><a href="#6-2-Accton-通过-usb0-口-SSH-访问-OpenBMC" class="headerlink" title="6.2. Accton 通过 usb0 口 SSH 访问 OpenBMC"></a>6.2. Accton 通过 usb0 口 SSH 访问 OpenBMC</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ping -6 -c 3 fe80::ff:fe00:1%usb0</span><br><span class="line"></span><br><span class="line">curl http://[fe80::ff:fe00:1%usb0]:8080/api/sys/bmc/tmp/mavericks</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 65X 获取 BMC 平台信息（通过 curl 从 BMC 获取信息）</span></span><br><span class="line">curl http://[fe80::ff:fe00:1%usb0]:8080/api/sys/mb/fruid</span><br><span class="line">curl http://[fe80::1%usb0]:8080/api/sys/mb/fruid</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ssh 访问（ root/0penBmc ）</span></span><br><span class="line">ssh -6 root@fe80::ff:fe00:1%usb0</span><br></pre></td></tr></table></figure>

<h2 id="6-3-BMC-IP-配置"><a href="#6-3-BMC-IP-配置" class="headerlink" title="6.3. BMC IP 配置"></a>6.3. BMC IP 配置</h2><p>以 Accton 设备为例</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看 BMC 版本</span></span><br><span class="line">ipmitool mc info</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查询 BMC IP</span></span><br><span class="line">ipmitool lan print</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 配置 BMC 网络 IP</span></span><br><span class="line">ipmitool lan set 1 ipaddr 10.32.124.155</span><br><span class="line">ipmitool lan set 1 netmask 255.255.255.0</span><br><span class="line">ipmitool lan set 1 defgw ipaddr 10.32.124.1</span><br><span class="line"><span class="meta">#</span><span class="bash"> ipmitool lan <span class="built_in">set</span> 1 macaddr  <span class="built_in">fc</span>:76:92:00:03:11</span></span><br></pre></td></tr></table></figure>

<h2 id="6-4-BMC-侧重启-COME-侧"><a href="#6-4-BMC-侧重启-COME-侧" class="headerlink" title="6.4. BMC 侧重启 COME 侧"></a>6.4. BMC 侧重启 COME 侧</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config_power -d cpu -a cycle</span><br></pre></td></tr></table></figure>

<h2 id="6-5-BMC-侧重启-SONiC"><a href="#6-5-BMC-侧重启-SONiC" class="headerlink" title="6.5. BMC 侧重启 SONiC"></a>6.5. BMC 侧重启 SONiC</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wedge_power.sh reset;sol.sh</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Accton XLT</span></span><br><span class="line">ipmitool power cycle</span><br><span class="line">ipmitool power reset</span><br></pre></td></tr></table></figure>

<h1 id="7-vEOS"><a href="#7-vEOS" class="headerlink" title="7. vEOS"></a>7. vEOS</h1><h2 id="7-1-vEOS-版本"><a href="#7-1-vEOS-版本" class="headerlink" title="7.1. vEOS 版本"></a>7.1. vEOS 版本</h2><p><a target="_blank" rel="noopener" href="https://www.arista.com/">官网</a><br><a target="_blank" rel="noopener" href="https://www.arista.com/en/um-eos/eos-command-line-interface-cli#xx1097818">EOS Command-Line Interface (CLI) - Arista</a></p>
<p>镜像：</p>
<p>ls -l &#x2F;home&#x2F;sonic&#x2F;veos-vm&#x2F;images&#x2F;<br>-rw-r–r– 1 sonic sonic   5242880 Nov  9  2020 Aboot-veos-serial-8.0.0.iso<br>-rw-r–r– 1 sonic sonic 662503424 Nov  9  2020 vEOS-lab-4.20.15M.vmdk</p>
<h2 id="7-2-进入-cli"><a href="#7-2-进入-cli" class="headerlink" title="7.2. 进入 cli"></a>7.2. 进入 cli</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/Cli</span><br><span class="line">enable</span><br></pre></td></tr></table></figure>

<h2 id="7-3-查看-BGP-信息"><a href="#7-3-查看-BGP-信息" class="headerlink" title="7.3. 查看 BGP 信息"></a>7.3. 查看 BGP 信息</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 进入 vEOS cli</span></span><br><span class="line">/usr/bin/Cli</span><br><span class="line">enable</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看 BGP 简要信息</span></span><br><span class="line">show ip bgp summary</span><br><span class="line">show ipv6 bgp summary</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看特定 neighbor</span></span><br><span class="line">show ip bgp neighbor 192.168.0.2</span><br><span class="line">show ip bgp neighbor 10.0.0.40</span><br><span class="line">show ip bgp neighbor 10.0.0.56</span><br><span class="line">show ipv6 bgp neighbor fc00::51</span><br><span class="line">show ip bgp neighbors</span><br><span class="line"><span class="meta">#</span><span class="bash"> 其他</span></span><br><span class="line">show lacp neighbor</span><br><span class="line"></span><br><span class="line">show bgp convergence</span><br><span class="line">show bgp instance</span><br><span class="line">show bgp labeled-unicast tunnel</span><br><span class="line">show bgp statistics</span><br><span class="line">show ip route bgp</span><br><span class="line">show ipv6 route bgp</span><br></pre></td></tr></table></figure>

<h2 id="7-4-vEOS-配置-BGP"><a href="#7-4-vEOS-配置-BGP" class="headerlink" title="7.4. vEOS 配置 BGP"></a>7.4. vEOS 配置 BGP</h2><p><a target="_blank" rel="noopener" href="https://www.arista.com/en/um-eos/eos-border-gateway-protocol-bgp#xx1115278">官方 cli 命令</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/Cli</span><br><span class="line">ebable</span><br><span class="line"><span class="meta">switchA(config)#</span><span class="bash"> router bgp 100</span></span><br><span class="line"><span class="meta">switchA(config-router-bgp)#</span><span class="bash"> neighbor 10.100.100.2 remote-as 100</span></span><br><span class="line"><span class="meta">switchA(config-router-bgp)#</span><span class="bash"> network 10.10.1.0/24</span></span><br><span class="line"><span class="meta">switchA(config-router-bgp)#</span><span class="bash"> network 10.10.2.0/24</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> switchA(config-router-bgp)<span class="comment"># neighbor 10.100.100.2 export-localpref 150</span></span></span><br><span class="line"><span class="meta">switchA(config-router-bgp)#</span><span class="bash"> timer bgp 30 90</span></span><br></pre></td></tr></table></figure>

<h1 id="8-redis"><a href="#8-redis" class="headerlink" title="8. redis"></a>8. redis</h1><h2 id="8-1-Redis-各-DB-序号"><a href="#8-1-Redis-各-DB-序号" class="headerlink" title="8.1. Redis 各 DB 序号"></a>8.1. Redis 各 DB 序号</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">APPL_DB, -n 0 -p 6379</span><br><span class="line">ASIC_DB, -n 1 -p 6379</span><br><span class="line">COUNTERS_DB, -n 2 -p 6379</span><br><span class="line">LOGLEVEL_DB, -n 3 -p 6379</span><br><span class="line">CONFIG_DB, -n 4 -p 6379</span><br><span class="line">PFC_WD_DB, -n 5 -p 6379</span><br><span class="line">FLEX_COUNTER_DB, -n 5 -p 6379</span><br><span class="line">STATE_DB, -n 6 -p 6379</span><br><span class="line">SNMP_OVERLAY_DB, -n 7 -p 6379</span><br></pre></td></tr></table></figure>

<h2 id="8-2-开启-redis-容器中日志"><a href="#8-2-开启-redis-容器中日志" class="headerlink" title="8.2. 开启 redis 容器中日志"></a>8.2. 开启 redis 容器中日志</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 更改 redis 配置</span></span><br><span class="line">docker exec -it database vi /etc/redis/redis.conf</span><br><span class="line"></span><br><span class="line">loglevel debug</span><br><span class="line">logfile &quot;/var/log/redis/redis.log&quot;</span><br><span class="line">syslog-enabled yes</span><br><span class="line">syslog-ident redis</span><br><span class="line">syslog-facility local0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 重启 redis</span></span><br><span class="line">docker exec -it database supervisorctl restart redis</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> check</span></span><br><span class="line">docker exec -it database ls -l /var/log/redis/redis.log</span><br><span class="line">docker exec -it database tail -f /var/log/redis/redis.log</span><br></pre></td></tr></table></figure>

<h2 id="8-3-监听redis事件"><a href="#8-3-监听redis事件" class="headerlink" title="8.3. 监听redis事件"></a>8.3. 监听redis事件</h2><p>注: 需开启键空间事件通知</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h 127.0.0.1 -n 10 -p 6379 config get notify-keyspace-events</span><br><span class="line">redis-cli -h 127.0.0.1 -n 10 -p 6379 config set notify-keyspace-events &quot;KEA&quot;</span><br></pre></td></tr></table></figure>

<p>监听特定 DB</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h 127.0.0.1 -n 10 -p 6379 --csv psubscribe &#x27;__key*__:*&#x27;</span><br><span class="line"></span><br><span class="line">redis-cli -h 127.0.0.1 -n 10 -p 6379 --csv psubscribe &#x27;__keyspace@10__:ROUTE_TO_IDC*&#x27;</span><br><span class="line"></span><br><span class="line">redis-cli -h 127.0.0.1 -n 10 -p 6379 --csv psubscribe &#x27;__keyspace@10__:CLOUD_ROUTE_CHANNEL*&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="8-4-监听特定-channel"><a href="#8-4-监听特定-channel" class="headerlink" title="8.4. 监听特定 channel"></a>8.4. 监听特定 channel</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h 127.0.0.1 -n 10 -p 6379</span><br><span class="line">SUBSCRIBE CLOUD_ROUTE_CHANNEL</span><br></pre></td></tr></table></figure>

<h2 id="8-5-批量增删操作-redis"><a href="#8-5-批量增删操作-redis" class="headerlink" title="8.5. 批量增删操作 redis"></a>8.5. 批量增删操作 redis</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">for ((i=4; i&lt;110; i++)); do redis-cli -h 127.0.0.1 -n 10 -p 6379 hmset &quot;ROUTE_TO_IDC#Vrf30002#192.168.$i.0/24&quot; &quot;type&quot; &quot;bgp&quot; &quot;vni&quot; &quot;30000&quot; &quot;aspath&quot; &quot;200,100&quot; &quot;timestamp&quot; &quot;1718269677&quot; ;done</span><br><span class="line"></span><br><span class="line">for ((i=4; i&lt;110; i++)); do redis-cli -h 127.0.0.1 -n 10 -p 6379 del &quot;ROUTE_TO_IDC#Vrf30002#192.168.$i.0/24&quot;;done</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="8-6-Redis-备份哪些表"><a href="#8-6-Redis-备份哪些表" class="headerlink" title="8.6. Redis 备份哪些表"></a>8.6. Redis 备份哪些表</h2><p>&#x2F;etc&#x2F;sonic&#x2F;libra_index.json，里面控制哪些表可以写到 config_db.json，这样保存配置重启才会生效</p>
<h1 id="9-Rsyslog"><a href="#9-Rsyslog" class="headerlink" title="9. Rsyslog"></a>9. Rsyslog</h1><h2 id="9-1-重新根据-lib-user-json-生成-rsyslog-conf-并重启服务"><a href="#9-1-重新根据-lib-user-json-生成-rsyslog-conf-并重启服务" class="headerlink" title="9.1. 重新根据 lib_user.json 生成 rsyslog.conf 并重启服务"></a>9.1. 重新根据 lib_user.json 生成 rsyslog.conf 并重启服务</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo sh /usr/bin/rsyslog-config.sh</span><br></pre></td></tr></table></figure>

<h2 id="9-2-重启-Rsyslog-服务"><a href="#9-2-重启-Rsyslog-服务" class="headerlink" title="9.2. 重启 Rsyslog 服务"></a>9.2. 重启 Rsyslog 服务</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 宿主机内重启</span></span><br><span class="line">sudo service rsyslog restart</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 所有容器内重启</span></span><br><span class="line">docker ps -a | tail -n +2 | awk &#x27;&#123; print $NF&#125;&#x27; | xargs -I &#123;&#125; docker exec &#123;&#125; service rsyslog restart &gt; /dev/null 2&gt;&amp;1</span><br></pre></td></tr></table></figure>

<h2 id="9-3-查看本地日志策略"><a href="#9-3-查看本地日志策略" class="headerlink" title="9.3. 查看本地日志策略"></a>9.3. 查看本地日志策略</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看 bgp （bgpd、staticd、zebra）的日志输出级别</span></span><br><span class="line">vtysh -c &#x27;show logging&#x27;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改</span></span><br><span class="line">vtysh -c &#x27;configure terminal&#x27; -c &#x27;log syslog (debugging|informational|notifications|warnings|errors|critical|alerts|emergencies)&#x27;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看 swssloglevel 日志输出级别</span></span><br><span class="line">swssloglevel -p</span><br><span class="line"><span class="meta">#</span><span class="bash"> 更改 swssloglevel 日志输出级别</span></span><br><span class="line">swssloglevel -l (DEBUG|INFO|NOTICE|WARN|ERROR|CRIT|ALERT|EMERG) -c (cfgmgrd|fdbmgrd|fpmsyncd|hwmgrd|monitorlinkd|neighsyncd|orchagent|portsyncd|switchmgrd|syncd|teammgrd|teamsyncd|vrfmgrd|vxlanmgrd)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="9-4-查看-Rsyslog-日志上报策略"><a href="#9-4-查看-Rsyslog-日志上报策略" class="headerlink" title="9.4. 查看 Rsyslog 日志上报策略"></a>9.4. 查看 Rsyslog 日志上报策略</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看是否配置上报远程日志服务器</span></span><br><span class="line">cli -c &#x27;show syslog&#x27;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看 Rsyslog 配置文件上报策略</span></span><br><span class="line">grep -A 2 &quot;remote syslog server&quot; /etc/rsyslog.conf</span><br></pre></td></tr></table></figure>

<h2 id="9-5-查看-Rsyslog-远程日志服务器状态"><a href="#9-5-查看-Rsyslog-远程日志服务器状态" class="headerlink" title="9.5. 查看 Rsyslog 远程日志服务器状态"></a>9.5. 查看 Rsyslog 远程日志服务器状态</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看 Rsyslog 服务状态</span></span><br><span class="line">sudo systemctl status rsyslog | grep &#x27;Active&#x27;</span><br><span class="line">sudo service rsyslog status</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看 UDP 链接</span></span><br><span class="line">sudo ss -tulnp | grep &quot;rsyslog&quot;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看本地打开 514 端口的程序</span></span><br><span class="line">sudo lsof -i:514</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看防火墙配置状态</span></span><br><span class="line">sudo iptables -L -n | grep 514</span><br></pre></td></tr></table></figure>

<h2 id="9-6-Rsyslog-客户端与日志服务器端配置"><a href="#9-6-Rsyslog-客户端与日志服务器端配置" class="headerlink" title="9.6. Rsyslog 客户端与日志服务器端配置"></a>9.6. Rsyslog 客户端与日志服务器端配置</h2><blockquote>
<p>客户端上报日志不会影响本地日志输出配置</p>
</blockquote>
<p>根据采用的传输协议，可配置成 TCP &#x2F; UDP 方式上报日志</p>
<h3 id="9-6-1-TCP-方式"><a href="#9-6-1-TCP-方式" class="headerlink" title="9.6.1. TCP 方式"></a>9.6.1. TCP 方式</h3><ul>
<li><p><strong>日志服务器配置</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 打开防火墙 TCP:514 端口</span></span><br><span class="line">iptables -L -n | grep 514</span><br><span class="line">sudo iptables -A INPUT -p tcp --dport 514 -j ACCEPT</span><br><span class="line">sudo iptables-save</span><br><span class="line">service rsyslog restart</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 备份原配置</span></span><br><span class="line">sudo cp /etc/rsyslog.conf /etc/rsyslog.conf_bak</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 编辑 /etc/rsyslog.conf 配置文件</span></span><br><span class="line">sudo vi /etc/rsyslog.conf</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4(a). 新接收配置方式（推荐）</span></span><br><span class="line">module(load=&quot;imtcp&quot;) # needs to be done just once</span><br><span class="line">input(type=&quot;imtcp&quot; port=&quot;514&quot; address=&quot;192.168.3.34&quot;)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4(b). 旧接收配置（与上方等效）</span></span><br><span class="line"><span class="meta">$</span><span class="bash">ModLoad imtcp</span></span><br><span class="line"><span class="meta">$</span><span class="bash">InputTCPServerRun 514</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 5. 重启 Rsyslog 服务使配置生效</span></span><br><span class="line">sudo service rsyslog restart</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>日志上报客户端配置</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 打开防火墙 TCP:514 端口</span></span><br><span class="line">sudo iptables -A INPUT -p tcp --dport 514 -j ACCEPT</span><br><span class="line">sudo iptables-save</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 备份原配置</span></span><br><span class="line">sudo cp /etc/rsyslog.conf /etc/rsyslog.conf_bak</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 编辑 /etc/rsyslog.conf 配置文件</span></span><br><span class="line">sudo vi /etc/rsyslog.conf</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4. 在第 45 行 <span class="string">&#x27;#Set remote syslog server&#x27;</span> 下增加远程日志服务器配置</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4(a). 新上报服务器配置（推荐）</span></span><br><span class="line">local2.notice action(type=&quot;omfwd&quot; target=&quot;192.168.3.34&quot; port=&quot;514&quot; protocol=&quot;tcp&quot;)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4(b). 旧上报服务器配置（与 4(a) 等效）, 其中：<span class="string">&#x27;@&#x27;</span>表示 UDP 协议；<span class="string">&#x27;@@&#x27;</span>表示 TCP 协议</span></span><br><span class="line">local2.notice @@[192.168.3.34:514]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 5. 重启 Rsyslog 服务使配置生效</span></span><br><span class="line">sudo service rsyslog restart</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>验证</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 日志服务器端监听 /var/<span class="built_in">log</span>/syslog 文件</span></span><br><span class="line">sudo tail -f /var/log/syslog | grep &quot;LOGGING TEST&quot;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 日志上报客户端模拟生成一条 syslog 消息</span></span><br><span class="line">logger -p local2.error &#x27;LOGGING TEST: this is a upload msg.&#x27;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 正常情况，日志服务器会收到如下日志</span></span><br><span class="line">2022-06-13 17:34:47.818912 sonic &lt;local2.err&gt; ERR admin: LOGGING TEST: this is a upload msg.</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="9-6-2-UDP-方式"><a href="#9-6-2-UDP-方式" class="headerlink" title="9.6.2. UDP 方式"></a>9.6.2. UDP 方式</h3><ul>
<li><p><strong>日志服务器配置</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 打开防火墙 UDP:514 端口</span></span><br><span class="line">iptables -L -n | grep 514</span><br><span class="line">iptables -A INPUT -p udp --dport 514 -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> iptables -D INPUT -p udp --dport 514 -j ACCEPT</span></span><br><span class="line">iptables-save</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 备份原配置</span></span><br><span class="line">sudo cp /etc/rsyslog.conf /etc/rsyslog.conf_bak</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 编辑 /etc/rsyslog.conf 配置文件</span></span><br><span class="line">sudo vi /etc/rsyslog.conf</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4(a). 新接收配置方式（推荐），替换 22,23 行</span></span><br><span class="line">module(load=&quot;imudp&quot;) # needs to be done just once</span><br><span class="line">input(type=&quot;imudp&quot; port=&quot;514&quot; address=&quot;192.168.3.34&quot;)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4(b). 旧接收配置（与上方等效），注释第 22 行</span></span><br><span class="line"><span class="meta">$</span><span class="bash">ModLoad imudp</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="variable">$UDPServerAddress</span> 127.0.0.1 <span class="comment"># bind to localhost before udp server run</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">UDPServerRun 514</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 5. 重启 Rsyslog 服务使配置生效</span></span><br><span class="line">sudo service rsyslog restart</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>日志上报客户端配置</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 打开防火墙 UDP:514 端口</span></span><br><span class="line">sudo iptables -A INPUT -p udp --dport 514 -j ACCEPT</span><br><span class="line">sudo iptables-save</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 备份原配置</span></span><br><span class="line">sudo cp /etc/rsyslog.conf /etc/rsyslog.conf_bak</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 编辑 /etc/rsyslog.conf 配置文件</span></span><br><span class="line">sudo vi /etc/rsyslog.conf</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4. 在第 45 行 <span class="string">&#x27;#Set remote syslog server&#x27;</span> 下增加远程日志服务器配置</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4(a). 新上报服务器配置（推荐）</span></span><br><span class="line">local2.notice action(type=&quot;omfwd&quot; target=&quot;192.168.3.34&quot; port=&quot;514&quot; protocol=&quot;udp&quot;)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4(b). 旧上报服务器配置（与 4(a) 等效）, 其中：<span class="string">&#x27;@&#x27;</span>表示 UDP 协议；<span class="string">&#x27;@@&#x27;</span>表示 UDP 协议</span></span><br><span class="line">local2.notice @[192.168.3.34]:514</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 5. 重启 Rsyslog 服务使配置生效</span></span><br><span class="line">sudo service rsyslog restart</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>验证</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 日志服务器端监听 /var/<span class="built_in">log</span>/syslog 文件</span></span><br><span class="line">sudo tail -f /var/log/syslog | grep &quot;LOGGING TEST&quot;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 日志上报客户端模拟生成一条 syslog 消息</span></span><br><span class="line">logger -p local2.error &#x27;LOGGING TEST: this is a upload msg2.&#x27;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 正常情况，日志服务器会收到如下日志</span></span><br><span class="line">2022-06-13 17:34:47.818912 sonic &lt;local2.err&gt; ERR admin: LOGGING TEST: this is a upload msg.</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="9-7-检查-Rsyslog-日志上报-配置"><a href="#9-7-检查-Rsyslog-日志上报-配置" class="headerlink" title="9.7. 检查 Rsyslog 日志上报 配置"></a>9.7. 检查 Rsyslog 日志上报 配置</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看远程日志服务器 IP【cli 界面执行】</span></span><br><span class="line">show syslog</span><br><span class="line"><span class="meta">#</span><span class="bash"> Linux Shell 界面执行</span></span><br><span class="line">/usr/bin/cli -c &#x27;show syslog&#x27;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 校验</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 校验 Rsyslog 配置文件【模板】</span></span><br><span class="line">grep -A 4 &quot;remote syslog server&quot; /usr/share/sonic/templates/rsyslog.conf.j2</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 校验 Rsyslog 配置文件</span></span><br><span class="line">grep -A 2 &quot;remote syslog server&quot; /etc/rsyslog.conf</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 验证 Redis</span></span><br><span class="line">docker exec database redis-cli -n 4 keys &quot;SYSLOG_SERVER*&quot;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 验证全量配置 libra_user.json</span></span><br><span class="line">grep -A 4 &quot;SYSLOG_SERVER&quot; /etc/sonic/libra_user.json</span><br></pre></td></tr></table></figure>

<h2 id="9-8-cli-配置远程日志服务器"><a href="#9-8-cli-配置远程日志服务器" class="headerlink" title="9.8. cli 配置远程日志服务器"></a>9.8. cli 配置远程日志服务器</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cli</span><br><span class="line">configure terminal</span><br><span class="line">system-config</span><br><span class="line">syslog</span><br><span class="line">log-server 192.168.3.34</span><br><span class="line">log-server 192.168.3.35</span><br><span class="line">do show syslog</span><br></pre></td></tr></table></figure>

<h2 id="9-9-Rsyslog-同时输出相同日志到多个文件测试-1【基于-facility-与-loglevel】"><a href="#9-9-Rsyslog-同时输出相同日志到多个文件测试-1【基于-facility-与-loglevel】" class="headerlink" title="9.9. Rsyslog 同时输出相同日志到多个文件测试 1【基于 facility 与 loglevel】"></a>9.9. Rsyslog 同时输出相同日志到多个文件测试 1【基于 facility 与 loglevel】</h2><p>&#x2F;etc&#x2F;rsyslog.d&#x2F;99-default.conf 部分配置示例如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kern.*;local0.*;local1.*;local2.notice;local3.*;local4.*;\</span><br><span class="line">    local5.*;local6.*;local7.*      -/var/log/syslog</span><br><span class="line">local6.*                /var/log/local6.log</span><br><span class="line">*.error                 /var/log/error.log</span><br></pre></td></tr></table></figure>
<p>执行输出 syslog 消息指令测试 <code>logger -p local6.error "AAA TEST"</code>，将输出相同 3 条日志到 &#x2F;var&#x2F;log&#x2F;syslog、&#x2F;var&#x2F;log&#x2F;local6.log、&#x2F;var&#x2F;log&#x2F;error.log 中</p>
<h2 id="9-10-Rsyslog-同时输出相同日志到多个文件测试-2【基于消息体字段内容】"><a href="#9-10-Rsyslog-同时输出相同日志到多个文件测试-2【基于消息体字段内容】" class="headerlink" title="9.10. Rsyslog 同时输出相同日志到多个文件测试 2【基于消息体字段内容】"></a>9.10. Rsyslog 同时输出相同日志到多个文件测试 2【基于消息体字段内容】</h2><p>&#x2F;etc&#x2F;rsyslog.d&#x2F;99-default.conf 部分配置示例如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># test rules1</span></span></span><br><span class="line">if $msg contains &quot;ABC&quot; then &#123;</span><br><span class="line">    /var/log/abc.log</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># test rules2</span></span></span><br><span class="line">if $msg contains &#x27;DEF&#x27; then &#123;</span><br><span class="line">    /var/log/def.log</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行输出 syslog 消息指令测试 <code>logger -p local5.info "ABC DEF TEST1"</code>，将输出相同 3 条日志到 &#x2F;var&#x2F;log&#x2F;syslog、&#x2F;var&#x2F;log&#x2F;local6.log、&#x2F;var&#x2F;log&#x2F;error.log 中</p>
<h2 id="9-11-Rsyslog-配置中，终止后续文件中继续匹配"><a href="#9-11-Rsyslog-配置中，终止后续文件中继续匹配" class="headerlink" title="9.11. Rsyslog 配置中，终止后续文件中继续匹配"></a>9.11. Rsyslog 配置中，终止后续文件中继续匹配</h2><p>利用 <code>stop</code> 关键字 防止 local6.error 的日志同时输出到 &#x2F;var&#x2F;log&#x2F;local6.log 与 &#x2F;var&#x2F;log&#x2F;error.log</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">local6.*                /var/log/local6.log</span><br><span class="line">local6.*                stop</span><br><span class="line">*.error                 /var/log/error.log</span><br></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">local6.*                /var/log/local6.log</span><br><span class="line">&amp;                       stop</span><br><span class="line">*.error                 /var/log/error.log</span><br></pre></td></tr></table></figure>

<h2 id="9-12-Rsyslog-不支持直接变更-loglevel-及-facility-——-测试-Rsyslog-直接变更-facility【失败】"><a href="#9-12-Rsyslog-不支持直接变更-loglevel-及-facility-——-测试-Rsyslog-直接变更-facility【失败】" class="headerlink" title="9.12. Rsyslog 不支持直接变更 loglevel 及 facility  —— 测试 Rsyslog 直接变更 facility【失败】"></a>9.12. Rsyslog 不支持直接变更 loglevel 及 facility  —— 测试 Rsyslog 直接变更 facility【失败】</h2><p>file：&#x2F;etc&#x2F;rsyslog.d&#x2F;testinput.conf</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">ModLoad imfile</span></span><br><span class="line"><span class="meta">$</span><span class="bash">InputFileName /var/<span class="built_in">log</span>/testinput.log</span></span><br><span class="line"><span class="meta">$</span><span class="bash">InputFileTag testinput</span></span><br><span class="line"><span class="meta">$</span><span class="bash">InputFilePersistStateInterval 1</span></span><br><span class="line"><span class="meta">$</span><span class="bash">InputFileStateFile state-testinput</span></span><br><span class="line"><span class="meta">$</span><span class="bash">InputFileFacility local3</span></span><br><span class="line"><span class="meta">$</span><span class="bash">InputRunFileMonitor</span></span><br><span class="line"></span><br><span class="line">if $.syslogfacility == local0 then &#123;</span><br><span class="line">    reset $.syslogfacility = local2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="9-13-Rsyslog-开启调试"><a href="#9-13-Rsyslog-开启调试" class="headerlink" title="9.13. Rsyslog 开启调试"></a>9.13. Rsyslog 开启调试</h2><p>在配置文件 &#x2F;etc&#x2F;rsyslog.conf 末增加如下调试配置：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Debugging ###</span></span></span><br><span class="line">local7.* /var/log/syslog.debug;RSYSLOG_DebugFormat</span><br><span class="line"><span class="meta">$</span><span class="bash">DebugFile /var/<span class="built_in">log</span>/syslog.debug</span></span><br><span class="line"><span class="meta">$</span><span class="bash">DebugLevel 2</span></span><br></pre></td></tr></table></figure>

<h2 id="9-14-配置-Rsyslog-启动（Mac）"><a href="#9-14-配置-Rsyslog-启动（Mac）" class="headerlink" title="9.14. 配置 Rsyslog 启动（Mac）"></a>9.14. 配置 Rsyslog 启动（Mac）</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 以后台服务启动</span></span><br><span class="line">brew services start rsyslog</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 以进程启动</span></span><br><span class="line">/opt/homebrew/opt/rsyslog/sbin/rsyslogd -n -f /opt/homebrew/etc/rsyslog.conf -i /opt/homebrew/var/run/rsyslogd.pid</span><br></pre></td></tr></table></figure>

<h2 id="9-15-sonic-mgmt"><a href="#9-15-sonic-mgmt" class="headerlink" title="9.15. sonic-mgmt"></a>9.15. sonic-mgmt</h2><h2 id="9-16-mgmt-topo-相关-brctl-指令"><a href="#9-16-mgmt-topo-相关-brctl-指令" class="headerlink" title="9.16. mgmt-topo 相关 brctl 指令"></a>9.16. mgmt-topo 相关 brctl 指令</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brctl show</span><br></pre></td></tr></table></figure>

<h2 id="9-17-mgmt-topo-相关-Open-vSwitch-指令"><a href="#9-17-mgmt-topo-相关-Open-vSwitch-指令" class="headerlink" title="9.17. mgmt-topo 相关 Open vSwitch 指令"></a>9.17. mgmt-topo 相关 Open vSwitch 指令</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建 ovs Bridge</span></span><br><span class="line">ovs-vsctl --may-exist add-br &lt;bridge_name&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 配置 mtu</span></span><br><span class="line">ifconfig &lt;bridge_name&gt; mtu &lt;mtu_val&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动</span></span><br><span class="line">ifconfig &lt;bridge_name&gt; up</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除 ovs Bridge</span></span><br><span class="line">ovs-vsctl --if-exists del-br &lt;bridge_name&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看 bridge 的 VLAN</span></span><br><span class="line">ovs-vsctl br-to-vlan &lt;bridge_name&gt;</span><br><span class="line">ovs-vsctl br-to-vlan br-VM0501-0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看 bridge 的 parent</span></span><br><span class="line">ovs-vsctl br-to-parent &lt;bridge_name&gt;</span><br><span class="line">ovs-vsctl br-to-parent br-VM0501-0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看 bridge 端口列表（e.g. br-VM0501-0）</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ovs-vsctl list-ports &lt;bridge_name&gt;</span></span><br><span class="line">ovs-vsctl list-ports br-VM0501-0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看 port 所属的 bridge</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ovs-vsctl port-to-br &lt;port_name&gt;</span></span><br><span class="line">ovs-vsctl port-to-br VM0501-t0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看</span></span><br><span class="line">ovs-vsctl show</span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加 ovs 端口绑定</span></span><br><span class="line">ovs-vsctl add-port &lt;bridge_name&gt; &lt;port_name&gt;</span><br><span class="line">ovs-vsctl add-port br-VM0501-0 VM0501-t0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 解除 ovs 端口绑定</span></span><br><span class="line">ovs-vsctl del-port &lt;bridge_name&gt; &lt;port_name&gt;</span><br><span class="line">ovs-vsctl del-port br-VM0501-0 VM0501-t0</span><br><span class="line"></span><br><span class="line">ovs-vsctl del-port br-VM0502-0 VM0502-t0</span><br><span class="line">ovs-vsctl add-port br-VM0501-0 VM0502-t0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看 open flow 规则</span></span><br><span class="line">ovs-ofctl dump-flows br-VM0501-0</span><br><span class="line">ovs-ofctl dump-flows br-VM0502-0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加 open flow 规则</span></span><br><span class="line">ovs-ofctl add-flow &lt;bridge_name&gt; table=0,in_port=&lt;vm_iface&gt;,action=output:&lt;out_iface&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除 open flow 规则</span></span><br><span class="line">ovs-ofctl del-flows &lt;bridge_name&gt;</span><br><span class="line"></span><br><span class="line">ovs-vsctl show | grep -A 10 &#x27;Bridge &quot;br-VM0501-0&quot;&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="9-18-mgmt-调大-fanout-侧对-lldp、lacp-协议的上报限速值"><a href="#9-18-mgmt-调大-fanout-侧对-lldp、lacp-协议的上报限速值" class="headerlink" title="9.18. mgmt 调大 fanout 侧对 lldp、lacp 协议的上报限速值"></a>9.18. mgmt 调大 fanout 侧对 lldp、lacp 协议的上报限速值</h2><blockquote>
<p>fanout交换机是通过bpdu tunnel把lldp、lacp报文上送CPU做的软转发，上送报文默认限速是600pps，所以mgmt测试流量上不来。</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建流分类器</span></span><br><span class="line">traffic classifier lldp operator and</span><br><span class="line">  if-match control-plane protocol lldp</span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建流行为</span></span><br><span class="line">traffic behavior lldp</span><br><span class="line">  car cir pps 2000 cbs 125440 ebs 0 green pass red discard yellow pass</span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建流策略，并绑定流分类器和流行为</span></span><br><span class="line">qos policy lldp</span><br><span class="line">  classifier lldp behavior lldp</span><br><span class="line"><span class="meta">#</span><span class="bash"> 绑定流策略</span></span><br><span class="line">control-plane slot 1</span><br><span class="line">  qos apply policy lldp inbound</span><br></pre></td></tr></table></figure>

<h2 id="9-19-sonic-mgmt-VM-互通-配置"><a href="#9-19-sonic-mgmt-VM-互通-配置" class="headerlink" title="9.19. sonic-mgmt VM 互通 配置"></a>9.19. sonic-mgmt VM 互通 配置</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 为网卡增加 VLAN interface</span></span><br><span class="line">ip link add link ma1 name x777 type vlan id 777</span><br><span class="line">ip link set x777 up</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 配置 IP（vlan777）：设备 1</span></span><br><span class="line">ip addr add 17.0.0.1/24 dev x777</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 配置 IP（vlan777）：设备 2</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ip addr add 17.0.0.2/24 dev x777</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 撤销 IP（vlan 777）：设备 1</span></span><br><span class="line">ip addr del 17.0.0.1/24 dev x777</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 撤销 IP（vlan 777）：设备 2</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ip addr del 17.0.0.2/24 dev x777</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除 vlan interface</span></span><br><span class="line">ip link set x777 down</span><br><span class="line">ip link del x777</span><br></pre></td></tr></table></figure>

<h1 id="10-编译"><a href="#10-编译" class="headerlink" title="10. 编译"></a>10. 编译</h1><h2 id="10-1-手动创建-SONiC-编译容器"><a href="#10-1-手动创建-SONiC-编译容器" class="headerlink" title="10.1. 手动创建 SONiC 编译容器"></a>10.1. 手动创建 SONiC 编译容器</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SONIC_DIR=&#x27;/home/haoleeson/code/sonic&#x27;</span><br><span class="line">SLAVE_IMAGE=&#x27;sonic-slave-stretch-haoleeson:c883792fe60&#x27;</span><br><span class="line"></span><br><span class="line">docker run -dit --name my-sonic-image-build-env --privileged \</span><br><span class="line">    -v $SONIC_DIR:/sonic \</span><br><span class="line">    -e &quot;https_proxy=http://a.b.c.d:8118&quot; \</span><br><span class="line">    -e &quot;http_proxy=http://a.b.c.d:8118&quot; \</span><br><span class="line">    -e no_proxy=&quot;10.20.30.40,10.20.30.40&quot; \</span><br><span class="line">    -w /sonic $SLAVE_IMAGE</span><br></pre></td></tr></table></figure>

<h2 id="10-2-全量编译（博通）"><a href="#10-2-全量编译（博通）" class="headerlink" title="10.2. 全量编译（博通）"></a>10.2. 全量编译（博通）</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd /home/haoleeson/code/sonic</span><br><span class="line">rm -rf target/</span><br><span class="line">make init</span><br><span class="line">make configure PLATFORM=broadcom</span><br><span class="line">make target/sonic.bin</span><br></pre></td></tr></table></figure>

<h2 id="10-3-全量编译（Barefoot）"><a href="#10-3-全量编译（Barefoot）" class="headerlink" title="10.3. 全量编译（Barefoot）"></a>10.3. 全量编译（Barefoot）</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /home/haoleeson/code/sonic</span><br><span class="line">make init</span><br><span class="line">make configure PLATFORM=barefoot</span><br><span class="line">make target/sonic-barefoot.bin</span><br></pre></td></tr></table></figure>

<h2 id="10-4-P4-SDE9-3-2-编译"><a href="#10-4-P4-SDE9-3-2-编译" class="headerlink" title="10.4. P4 SDE9.3.2 编译"></a>10.4. P4 SDE9.3.2 编译</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./p4studio_build.py -up switch_p416_profile_sai15 -sp x1_tofino</span><br></pre></td></tr></table></figure>

<h2 id="10-5-编译支持-gdb"><a href="#10-5-编译支持-gdb" class="headerlink" title="10.5. 编译支持 gdb"></a>10.5. 编译支持 gdb</h2><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CFLAGS += -O0 -ggdb</span><br></pre></td></tr></table></figure>

<h1 id="11-排障"><a href="#11-排障" class="headerlink" title="11. 排障"></a>11. 排障</h1><h2 id="11-1-查看平台软件信息"><a href="#11-1-查看平台软件信息" class="headerlink" title="11.1. 查看平台软件信息"></a>11.1. 查看平台软件信息</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看设备 SN 序列号</span></span><br><span class="line">show version | grep &#x27;Serial Number&#x27;  | awk &#x27;&#123; print $NF &#125;&#x27;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看 SONIC 版本信息</span></span><br><span class="line">show version | grep &#x27;Version&#x27;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看设备类型</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> - TD4：BT200H0,BT200R0</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> - TH4:BS400H0,BS400R0</span></span><br><span class="line">show version | grep &#x27;HwSKU&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="11-1-1-查看-CPU-数"><a href="#11-1-1-查看-CPU-数" class="headerlink" title="11.1.1. 查看 CPU 数"></a>11.1.1. 查看 CPU 数</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看物理 CPU个数</span></span><br><span class="line">cat /proc/cpuinfo | grep &#x27;physical id&#x27; | sort | uniq | wc -l</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看物理 cpu 型号</span></span><br><span class="line">cat /proc/cpuinfo | grep &#x27;model name&#x27; | uniq</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看每个物理CPU中core的个数(即核数)</span></span><br><span class="line">cat /proc/cpuinfo | grep &#x27;cpu cores&#x27; | uniq</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看逻辑CPU的个数</span></span><br><span class="line">cat /proc/cpuinfo | grep processor | wc -l</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看 CPU 型号</span></span><br><span class="line">cat /proc/cpuinfo | grep name | cut -f2 -d: | uniq -c</span><br></pre></td></tr></table></figure>

<h3 id="11-1-2-查看内存大小"><a href="#11-1-2-查看内存大小" class="headerlink" title="11.1.2. 查看内存大小"></a>11.1.2. 查看内存大小</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">free -g -h -t</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> MEM 详情</span></span><br><span class="line">less /proc/meminfo</span><br></pre></td></tr></table></figure>

<h3 id="11-1-3-查看系统内存大页配置"><a href="#11-1-3-查看系统内存大页配置" class="headerlink" title="11.1.3. 查看系统内存大页配置"></a>11.1.3. 查看系统内存大页配置</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看</span></span><br><span class="line">grep Huge /proc/meminfo</span><br><span class="line">cat /proc/sys/vm/nr_hugepages</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 方式 1：配置指定大页数（ 128、4096 ）</span></span><br><span class="line">echo  8192 &gt; /proc/sys/vm/nr_hugepages</span><br><span class="line">echo  1024 &gt; /proc/sys/vm/nr_hugepages</span><br><span class="line">echo  12288 &gt; /proc/sys/vm/nr_hugepages</span><br><span class="line">echo  49152 &gt; /proc/sys/vm/nr_hugepages</span><br><span class="line">echo  153600 &gt; /proc/sys/vm/nr_hugepages</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> syncd 更改巨页数脚本</span></span><br><span class="line">/opt/bfn/install/bin/dma_setup.sh</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 方式 2：添加大页配置</span></span><br><span class="line">echo  &quot;vm.nr_hugepages=128 &quot;&gt;&gt; /etc/sysctl.conf</span><br><span class="line"><span class="meta">#</span><span class="bash"> 执行以生效配置</span></span><br><span class="line">sysctl -p</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看是否开启透明大页</span></span><br><span class="line">cat /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启用和关闭 hugepage</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> [always] madvise never 表示 已启用</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> always madvise [never] 表示 不启用时</span></span><br></pre></td></tr></table></figure>

<h3 id="11-1-4-查看磁盘挂载-list-disks"><a href="#11-1-4-查看磁盘挂载-list-disks" class="headerlink" title="11.1.4. 查看磁盘挂载 list disks"></a>11.1.4. 查看磁盘挂载 list disks</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看磁盘容量</span></span><br><span class="line">lsblk | grep -v loop</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查询磁盘使用情况</span></span><br><span class="line">df -h [-max-depth=1] [/opt]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看磁盘使用率</span></span><br><span class="line">du -ach [-max-depth=1] [/opt]</span><br><span class="line">du -ach -max-depth=1 /</span><br><span class="line">du -ach -d 1 /</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看挂载磁盘</span></span><br><span class="line">lsblk</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看挂载磁盘 及 操作系统</span></span><br><span class="line">lsblk -f</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看磁盘分区</span></span><br><span class="line">fdisk -l</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> mount挂载（ &lt;设备名称&gt; &lt;挂载目录&gt;）</span></span><br><span class="line">cd /</span><br><span class="line">mkdir newdisk</span><br><span class="line">mount /dev/sdb1 /newdisk</span><br><span class="line">lsblk -f</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> umount 取消挂载</span></span><br><span class="line">umount &lt;设备名称&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 实现永久挂载</span></span><br><span class="line">vim /etc/fstab</span><br><span class="line"><span class="meta">#</span><span class="bash"> 生效</span></span><br><span class="line">mount -a</span><br></pre></td></tr></table></figure>

<h2 id="11-2-查看平台硬件信息"><a href="#11-2-查看平台硬件信息" class="headerlink" title="11.2. 查看平台硬件信息"></a>11.2. 查看平台硬件信息</h2><h3 id="11-2-1-平台信息"><a href="#11-2-1-平台信息" class="headerlink" title="11.2.1. 平台信息"></a>11.2.1. 平台信息</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看平台简介信息</span></span><br><span class="line">show platform summary</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看存储在 eeprom 上的信息</span></span><br><span class="line">show platform syseeprom</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看电源状态</span></span><br><span class="line">show platform psustatus</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看风扇状态</span></span><br><span class="line">show platform fan</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看各平台设备温度</span></span><br><span class="line">show platform temperature</span><br></pre></td></tr></table></figure>

<h3 id="11-2-2-系统状态信息"><a href="#11-2-2-系统状态信息" class="headerlink" title="11.2.2. 系统状态信息"></a>11.2.2. 系统状态信息</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">show clock</span><br><span class="line">show boot</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示系统硬件信息（CPU 电压&amp;温度, 内存温度，风扇转速，电源电压&amp;温度&amp;功率&amp;转速，出入口温度，交换芯片温度）</span></span><br><span class="line">show environment</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示日志内容</span></span><br><span class="line">show logging | more</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示传感器日志</span></span><br><span class="line">show logging sensord</span><br></pre></td></tr></table></figure>

<h3 id="11-2-3-查看-Tofino-芯片是否能被识别"><a href="#11-2-3-查看-Tofino-芯片是否能被识别" class="headerlink" title="11.2.3. 查看 Tofino 芯片是否能被识别"></a>11.2.3. 查看 Tofino 芯片是否能被识别</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> COME 端执行</span></span><br><span class="line">lspci | egrep &#x27;1d1c|Tofino&#x27;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 回显示例</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 05:00.0 Unassigned class [ff00]: Barefoot Networks, Inc. Tofino 1 (rev 10)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 06:00.0 Unassigned class [ff00]: Barefoot Networks, Inc. Tofino 1 (rev 10)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 06:00.0 Unassigned class [ff00]: Device 1d1c:0010 (rev 10)</span></span><br></pre></td></tr></table></figure>

<h3 id="11-2-4-查看BIOS版本"><a href="#11-2-4-查看BIOS版本" class="headerlink" title="11.2.4. 查看BIOS版本"></a>11.2.4. 查看BIOS版本</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> （sonic侧）查看设备  BIOS Version</span></span><br><span class="line">sudo dmidecode -t bios | grep Ver | cut -d : -f 2</span><br></pre></td></tr></table></figure>

<h3 id="11-2-5-查看-eeprom-SN"><a href="#11-2-5-查看-eeprom-SN" class="headerlink" title="11.2.5. 查看 eeprom SN"></a>11.2.5. 查看 eeprom SN</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> （sonic 侧）查看设备 SN</span></span><br><span class="line">sudo decode-syseeprom -d | grep Serial | cut -c 31-</span><br></pre></td></tr></table></figure>

<h3 id="11-2-6-查看i2c设备"><a href="#11-2-6-查看i2c设备" class="headerlink" title="11.2.6. 查看i2c设备"></a>11.2.6. 查看i2c设备</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> i2c 路径，每个 i2c-x 对应一个 port</span></span><br><span class="line">ls /dev/i2c-*</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 读取 i2c 硬件信息</span></span><br><span class="line">i2cget -y -f 33 0x62 0x1</span><br><span class="line">i2cget -y -f 33 0x62 0x2</span><br><span class="line">i2cget -y -f 34 0x64 0x1</span><br><span class="line">i2cget -y -f 34 0x64 0x2</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 读取 i2c 端口 17 信息</span></span><br><span class="line">hexdump -C /sys/bus/i2c/devices/17-0050/sfp_eeprom</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 罗列检测到的 i2c 设备</span></span><br><span class="line">i2cdetect -l | sort</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 检测 i2c 设备</span></span><br><span class="line">i2cdetect -y 1</span><br><span class="line">i2cdetect -r -y 1</span><br><span class="line">i2cdump -y 1 0x44</span><br><span class="line">ls -l /sys/bus/i2c/devices/i2c-*</span><br></pre></td></tr></table></figure>

<h3 id="11-2-7-i2c-定位指令"><a href="#11-2-7-i2c-定位指令" class="headerlink" title="11.2.7. i2c 定位指令"></a>11.2.7. i2c 定位指令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看 i2c 设备</span></span><br><span class="line">i2cdetect -l | sort</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看指定驱动 ast（开启会影响 公版 XLT 初始化，导致端口未 ready）</span></span><br><span class="line">lsmod | grep -i ast</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 卸载 i2c 驱动</span></span><br><span class="line">modprobe -r i2c_dev</span><br><span class="line">modprobe -r ast</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装 i2c 驱动</span></span><br><span class="line">modprobe i2c_dev</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装驱动方式 2</span></span><br><span class="line">insmod /usr/lib/modules/4.19.0-12-2-amd64/extra/bf_kdrv.ko</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 重新扫描 pcie 硬件</span></span><br><span class="line">echo 1 &gt; /sys/bus/pci/rescan</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看 d message 信息</span></span><br><span class="line">dmesg</span><br><span class="line"><span class="meta">#</span><span class="bash"> 清理 d message 信息</span></span><br><span class="line">dmesg -C</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 卸载 i2c-33</span></span><br><span class="line">echo 0x62 &gt; /sys/bus/i2c/devices/i2c-33/delete_device</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 卸载 i2c-17</span></span><br><span class="line">echo 0x50 &gt; /sys/bus/i2c/devices/i2c-17/delete_device</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> dump i2c 0x33 信息</span></span><br><span class="line">i2cdetect -y 33</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> dump 指定 i2c 信息</span></span><br><span class="line">i2cget -y -f 33 0x62 0x2</span><br><span class="line">i2cget -y -f 34 0x64 0x1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查找驱动</span></span><br><span class="line">find / -name &#x27;ast*.ko*&#x27; 2&gt;&amp;1 | fgrep -v &#x27;find:&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="11-3-查看指定进程启动参数"><a href="#11-3-查看指定进程启动参数" class="headerlink" title="11.3. 查看指定进程启动参数"></a>11.3. 查看指定进程启动参数</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/&lt;pid&gt;/cmdline | tr &#x27;\0&#x27; &#x27;\n&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="11-4-sonic-cfggen-常用命令"><a href="#11-4-sonic-cfggen-常用命令" class="headerlink" title="11.4. sonic-cfggen 常用命令"></a>11.4. sonic-cfggen 常用命令</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 打印 configdb 数据库内容</span></span><br><span class="line">sonic-cfggen -d</span><br><span class="line">sonic-cfggen -d --print-data</span><br><span class="line"></span><br><span class="line">sonic-cfggen -d -v &#x27;BGP_NETWORK&#x27;</span><br><span class="line">sonic-cfggen -d -v &#x27;DEVICE_METADATA&#x27;</span><br><span class="line">sonic-cfggen -d -v &#x27;DEVICE_METADATA.localhost.hwsku&#x27;</span><br><span class="line">sonic-cfggen -d -v &#x27;DEVICE_METADATA.localhost.platform&#x27;</span><br><span class="line"></span><br><span class="line">sonic-cfggen -d -v &#x27;VERSIONS&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="11-5-服务容器启停"><a href="#11-5-服务容器启停" class="headerlink" title="11.5. 服务容器启停"></a>11.5. 服务容器启停</h2><p>不应通过docker命令直接停启SONiC中服务容器，而应通过 service 的方式</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 列出系统所有服务</span></span><br><span class="line">systemctl list-units --all --type=service</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 停止 radv 容器（服务）</span></span><br><span class="line">sudo service radv stop</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动 radv 容器（服务）</span></span><br><span class="line">sudo service radv start</span><br></pre></td></tr></table></figure>

<h2 id="11-6-I2C-死锁问题解决方法"><a href="#11-6-I2C-死锁问题解决方法" class="headerlink" title="11.6. I2C 死锁问题解决方法"></a>11.6. I2C 死锁问题解决方法</h2><ol>
<li><p>设备下电重启（因为 reboot 并非所有设备都下电）</p>
</li>
<li><p>软件使用9clk来reset</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1:拔掉所有光模块</span><br><span class="line"><span class="meta">#</span><span class="bash"> 在 bmc下执行</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">enable</span> one time generation of 9 clk</span></span><br><span class="line">i2cset -y -f 12 0x31 0x42 0x02;</span><br><span class="line"><span class="meta">#</span><span class="bash"> delay to allow 9 clk cycles</span></span><br><span class="line">usleep 10000;</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">disable</span> one time generation of 9 clk</span></span><br><span class="line">i2cset -y -f 12 0x31 0x42 0x0;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用 9clk reset cp2112</span></span><br><span class="line">i2cset -y -f 12 0x31 0x39 0xfd ; usleep 10000; i2cset -y -f 12 0x31 0x39 0xff;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> BMC 侧 重启 COME 侧电源</span></span><br><span class="line">wedge_power.sh reset</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="11-7-Accton交换机无法找到cdc-ethernet端口修复方法"><a href="#11-7-Accton交换机无法找到cdc-ethernet端口修复方法" class="headerlink" title="11.7. Accton交换机无法找到cdc_ethernet端口修复方法"></a>11.7. Accton交换机无法找到cdc_ethernet端口修复方法</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 串口登录设备 bmc，或通过其他设备 bmc ssh 登录 bmc</span></span><br><span class="line">记录此设备 bmc eth0 IPv6</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 关闭 COME 侧电源</span></span><br><span class="line">wedge_power.sh off</span><br><span class="line"><span class="meta">#</span><span class="bash"> check</span></span><br><span class="line">wedge_power.sh status</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. (opt). 执行修复 I2C 死锁问题</span></span><br><span class="line">i2cset -y -f 12 0x31 0x42 0x02;</span><br><span class="line">usleep 10000;</span><br><span class="line">i2cset -y -f 12 0x31 0x42 0x0;</span><br><span class="line">i2cset -y -f 12 0x31 0x39 0xfd ; usleep 10000; i2cset -y -f 12 0x31 0x39 0xff;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4. (opt). 在 bmc 侧执行，让 Tofino 芯片随设备一起 reset</span></span><br><span class="line">i2cset -f -y 12 0x31 0x32 0xf</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 5. 等待 COME 侧 stop 10 min</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 6. 重启 BMC，尝试软件达到 <span class="string">&quot;整机断电目的&quot;</span></span></span><br><span class="line">reboot</span><br></pre></td></tr></table></figure>

<h2 id="11-8-Accton-tofino-驱动无法识别问题"><a href="#11-8-Accton-tofino-驱动无法识别问题" class="headerlink" title="11.8. Accton tofino 驱动无法识别问题"></a>11.8. Accton tofino 驱动无法识别问题</h2><p>在 BMC 侧执行以下指令，（无串口时可通过其他同网段 BMC ssh 到目标设备 BMC）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 在 bmc 侧执行，让 Tofino 芯片随设备一起 reset</span></span><br><span class="line">i2cset -f -y 12 0x31 0x32 0xf</span><br><span class="line"><span class="meta">#</span><span class="bash"> bmc 侧让 come 下电上电</span></span><br><span class="line">wedge_power.sh off</span><br><span class="line">wedge_power.sh on</span><br><span class="line"><span class="meta">#</span><span class="bash"> 风扇控制</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> fand</span></span><br></pre></td></tr></table></figure>

<h2 id="11-9-Accton交换机查看BMC硬件信息"><a href="#11-9-Accton交换机查看BMC硬件信息" class="headerlink" title="11.9. Accton交换机查看BMC硬件信息"></a>11.9. Accton交换机查看BMC硬件信息</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看 BMC 版本</span></span><br><span class="line">cat /etc/issue</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看 EEPROM 信息</span></span><br><span class="line">weutil</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看传感器信息（电压、电流、功率、温度、风扇转速）</span></span><br><span class="line">sensors</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看 12, 5, 3.3, 2.5, 1.8, 1.5, 1.2, 0.9 V 实际电压</span></span><br><span class="line">btools.py --UCD sh v</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看光模块电压</span></span><br><span class="line">btools.py --IR sh v</span><br></pre></td></tr></table></figure>

<h2 id="11-10-SONiC版本升级"><a href="#11-10-SONiC版本升级" class="headerlink" title="11.10. SONiC版本升级"></a>11.10. SONiC版本升级</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo sonic_installer install -f sonic-barefoot-xxx.xxx.bin</span><br><span class="line">sudo reboot</span><br><span class="line"><span class="meta">#</span><span class="bash"> sonic的默认用户名：root，密码：YourPaSsWoRd</span></span><br></pre></td></tr></table></figure>

<h2 id="11-11-排查端口抖动"><a href="#11-11-排查端口抖动" class="headerlink" title="11.11. 排查端口抖动"></a>11.11. 排查端口抖动</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> - 查询指定时段 端口抖动日志</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> （正常 DOWN 端口无此日志；config reload 也会产生，故需筛查在无 reload时段）</span></span><br><span class="line">rm /tmp/start &gt; /etc/null 2&gt;&amp;1; touch --date &quot;2024-01-17 0:00:00&quot; /tmp/start &amp;&amp; \</span><br><span class="line">    rm /tmp/end &gt; /etc/null 2&gt;&amp;1; touch --date &quot;2024-01-20 23:00:00&quot; /tmp/end &amp;&amp; \</span><br><span class="line">    rm $HOME/port_flapping.log; cd /var/log/; \</span><br><span class="line">    find -type f -name &#x27;syslog*&#x27; -newer /tmp/start -not -newer /tmp/end -printf &quot;%T@\t%p\n&quot; | sort -n | cut -f 2- | xargs -t -I &#123;&#125; zgrep -E &#x27;Bridge: port [[:digit:]]&#123;1,2&#125;\((Ethernet[[:digit:]]&#123;1,2&#125;|dummy)\) entered disabled state&#x27; &#123;&#125; &gt;&gt; $HOME/port_flapping.log; wc -l $HOME/port_flapping.log</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> - 查询指定时段 端口 up_to_down 日志</span></span><br><span class="line">rm /tmp/start &gt; /etc/null 2&gt;&amp;1; touch --date &quot;2024-01-17 0:00:00&quot; /tmp/start &amp;&amp; \</span><br><span class="line">    rm /tmp/end &gt; /etc/null 2&gt;&amp;1; touch --date &quot;2024-01-20 23:00:00&quot; /tmp/end &amp;&amp; \</span><br><span class="line">    rm $HOME/port_up_to_down.log; cd /var/log/; \</span><br><span class="line">    find -type f -name &#x27;syslog*&#x27; -newer /tmp/start -not -newer /tmp/end -printf &quot;%T@\t%p\n&quot; | sort -n | cut -f 2- | xargs -t -I &#123;&#125; zgrep -C 30 -E &#x27;updatePortOperStatus: Port Ethernet[[:digit:]]&#123;1,2&#125; oper state set from up to down&#x27; &#123;&#125; &gt;&gt; $HOME/port_up_to_down.log; wc -l $HOME/port_up_to_down.log</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> - 查询指定时段 手动操作端口 DOWN 日志</span></span><br><span class="line">rm /tmp/start &gt; /etc/null 2&gt;&amp;1; touch --date &quot;2024-01-17 0:00:00&quot; /tmp/start &amp;&amp; \</span><br><span class="line">    rm /tmp/end &gt; /etc/null 2&gt;&amp;1; touch --date &quot;2024-01-20 23:00:00&quot; /tmp/end &amp;&amp; \</span><br><span class="line">    rm $HOME/set_port_down.log; cd /var/log/; \</span><br><span class="line">    find -type f -name &#x27;syslog*&#x27; -newer /tmp/start -not -newer /tmp/end -printf &quot;%T@\t%p\n&quot; | sort -n | cut -f 2- | xargs -t -I &#123;&#125; zgrep -E &#x27;doTask: Configure Ethernet[[:digit:]]&#123;1,2&#125; admin status to down&#x27; &#123;&#125; &gt;&gt; $HOME/set_port_down.log; wc -l $HOME/set_port_down.log</span><br></pre></td></tr></table></figure>

<h2 id="11-12-清零某启动失败-service-的失败计数"><a href="#11-12-清零某启动失败-service-的失败计数" class="headerlink" title="11.12. 清零某启动失败 service 的失败计数"></a>11.12. 清零某启动失败 service 的失败计数</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl reset-failed swss.service</span><br></pre></td></tr></table></figure>

<h2 id="11-13-通过sonic-cfggen获取网关v6-IP"><a href="#11-13-通过sonic-cfggen获取网关v6-IP" class="headerlink" title="11.13. 通过sonic-cfggen获取网关v6 IP"></a>11.13. 通过sonic-cfggen获取网关v6 IP</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">len=$(sonic-cfggen -d -v &quot;MGMT_INTERFACE.values()&quot; | grep -o gwaddr | wc -l)</span><br><span class="line">v6gwip=&#x27;&#x27;</span><br><span class="line"></span><br><span class="line">for ((i=0; i&lt;$len; i++)); do</span><br><span class="line">  ip=$(sonic-cfggen -d -v &quot;MGMT_INTERFACE.values()[$i].gwaddr&quot; 2&gt;&amp;1) &gt; /dev/null</span><br><span class="line">  echo &quot;ip:    $ip&quot;</span><br><span class="line">  if [[ $ip == *&quot;:&quot;* ]]; then</span><br><span class="line">    v6gwip=$ip</span><br><span class="line">  fi</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">if [[ -n &quot;$v6gwip&quot; ]]; then</span><br><span class="line">    echo &quot;v6gwip:    $v6gwip&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<h2 id="11-14-ONIE-查看系统-efi-启动顺序"><a href="#11-14-ONIE-查看系统-efi-启动顺序" class="headerlink" title="11.14. ONIE 查看系统 efi 启动顺序"></a>11.14. ONIE 查看系统 efi 启动顺序</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看顺序</span></span><br><span class="line">efibootmgr</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 执行 efibootmgr 回显值：设备启动执行顺序</span></span><br><span class="line">ONIE:/ # efibootmgr</span><br><span class="line">BootCurrent: 0019</span><br><span class="line">Timeout: 3 seconds</span><br><span class="line">BootOrder: 0019,001A,0002,0010,0012,0013,0015,0016,0017,0000,0001</span><br><span class="line">Boot0000  SONiC-OS</span><br><span class="line">Boot0001  Hard Drive</span><br><span class="line">Boot0002* UEFI: Built-in EFI Shell</span><br><span class="line">Boot0010* UEFI: PXE IP4 Intel(R) I210 Gigabit  Backplane Connection</span><br><span class="line">Boot0012* UEFI: PXE IP6 Intel(R) I210 Gigabit  Backplane Connection</span><br><span class="line">Boot0013* UEFI: Network Card</span><br><span class="line">Boot0015* UEFI: Network Card</span><br><span class="line">Boot0016* UEFI: Network Card</span><br><span class="line">Boot0017* UEFI: Network Card</span><br><span class="line">Boot0019* ONIE: Open Network Install Environment</span><br><span class="line">Boot001A* SONiC-OS</span><br><span class="line">MirroredPercentageAbove4G: 0.00</span><br><span class="line">MirrorMemoryBelow4GB: false</span><br><span class="line">ONIE:/ #</span><br><span class="line"></span><br><span class="line">ONIE:/var/log # efibootmgr</span><br><span class="line">BootCurrent: 0019</span><br><span class="line">Timeout: 3 seconds</span><br><span class="line">BootOrder: 0019,001A,0002,0010,0012,0013,0015,0016,0017,0000,0001</span><br><span class="line">Boot0000  SONiC-OS</span><br><span class="line">Boot0001  Hard Drive</span><br><span class="line">Boot0002* UEFI: Built-in EFI Shell</span><br><span class="line">Boot0010* UEFI: PXE IP4 Intel(R) I210 Gigabit  Backplane Connection</span><br><span class="line">Boot0012* UEFI: PXE IP6 Intel(R) I210 Gigabit  Backplane Connection</span><br><span class="line">Boot0013* UEFI: Network Card</span><br><span class="line">Boot0015* UEFI: Network Card</span><br><span class="line">Boot0016* UEFI: Network Card</span><br><span class="line">Boot0017* UEFI: Network Card</span><br><span class="line">Boot0019* ONIE: Open Network Install Environment</span><br><span class="line">Boot001A* SONiC-OS</span><br><span class="line">MirroredPercentageAbove4G: 0.00</span><br><span class="line">MirrorMemoryBelow4GB: false</span><br><span class="line">ONIE:/var/log #</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 更改启动顺序（BootOrder: 后的值）</span></span><br><span class="line">efibootmgr -o 001A,0019,0002,0010,0012,0013,0015,0016,0017,0000,0001</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="11-15-gdb调试coredump文件"><a href="#11-15-gdb调试coredump文件" class="headerlink" title="11.15. gdb调试coredump文件"></a>11.15. gdb调试coredump文件</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 拷贝解压后的 core 到 HOST 的 ~/core_files/</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 解压 gz（保留源文件）</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> gunzip -c x.core.gz &gt; x.core</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> To debug a core file <span class="keyword">in</span> non-SONiC environment that supports docker</span></span><br><span class="line">docker load -i docker-&lt;name&gt;-dbg.gz</span><br><span class="line">docker load -i docker-orchagent-dbg.gz</span><br><span class="line">docker load -i docker-syncd-bfn-dbg.gz</span><br><span class="line"></span><br><span class="line">docker tag f3e7100d47f1 docker-syncd-bfn-dbg__65x_release_20230110:sde932</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> copy your unzipped core file into ~/core_files</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> CONTAINER_NAME=<span class="string">&#x27;orchagent_dbg__xlt&#x27;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> IMAGE_NAME=<span class="string">&#x27;docker-orchagent-dbg__xlt_20221104:sde990&#x27;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> CONTAINER_NAME=<span class="string">&#x27;syncd_dbg__xlt&#x27;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> IMAGE_NAME=<span class="string">&#x27;docker-syncd-bfn-dbg__xlt_20221104:sde990&#x27;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> CONTAINER_NAME=<span class="string">&#x27;orchagent_dbg__65x&#x27;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> IMAGE_NAME=<span class="string">&#x27;docker-orchagent-dbg__65x_release_20230110:sde932&#x27;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> CONTAINER_NAME=<span class="string">&#x27;syncd_dbg__65x__230110&#x27;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> IMAGE_NAME=<span class="string">&#x27;docker-syncd-bfn-dbg__65x_release_20230110:sde932&#x27;</span></span></span><br><span class="line"></span><br><span class="line">CONTAINER_NAME=&#x27;syncd_dbg__65x__230110_ugw_r&#x27;</span><br><span class="line">IMAGE_NAME=&#x27;docker-syncd-bfn-dbg__65x_release_20230110:sde932&#x27;</span><br><span class="line"></span><br><span class="line">CONTAINER_NAME=&#x27;syncd_dbg__65x__230110_try_ugw_r&#x27;</span><br><span class="line">IMAGE_NAME=&#x27;docker-syncd-bfn-dbg__65x_release_20230110:sde932_try_ugw_r&#x27;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> CONTAINER_NAME=<span class="string">&#x27;bgp_dbg__65x&#x27;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> IMAGE_NAME=<span class="string">&#x27;docker-bgp-dbg__65x_release_20230110:sde932&#x27;</span></span></span><br><span class="line"></span><br><span class="line">docker run -dit --name $CONTAINER_NAME --entrypoint=/bin/bash -v ~/core_files:/core_files -w /core_files/ $IMAGE_NAME</span><br><span class="line">docker exec -it $CONTAINER_NAME bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在容器中安装 libc6 调试库（带符号表）</span></span><br><span class="line">apt-get install -y --force-yes libc6-dev libc6-dbg libthread_db</span><br><span class="line"></span><br><span class="line">apt-cache search glibc | grep -i dbg</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装 libstdc++ 调试符号表</span></span><br><span class="line">apt-cache search libstdc++ | grep -i dbg</span><br><span class="line">apt-get install -y --force-yes libstdc++6-6-dbg</span><br><span class="line">apt-get install -y --force-yes libstdc++6-7-dbg</span><br><span class="line">apt-get install -y --force-yes libstdc++6-8-dbg</span><br><span class="line"></span><br><span class="line">exit</span><br><span class="line">docker stop $CONTAINER_NAME</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> core_files</span></span><br><span class="line">gdb -q /usr/bin/&lt;your binary&gt; -c /core_files/&lt;your core&gt;</span><br><span class="line">gdb -q /usr/bin/orchagent -c /core_files/orchagent.1667560417.35.core</span><br><span class="line">gdb -q /usr/bin/syncd -c /core_files/syncd.1667749314.25.core</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看 堆栈信息</span></span><br><span class="line">bt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查找出现Crash的最后一个函数</span></span><br><span class="line">f 0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 查看此函数入参</span></span></span><br><span class="line">info args</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 查看函数局部变量</span></span></span><br><span class="line">info locals</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 检查有哪些链接库缺失符号表</span></span><br><span class="line">info sharedlibrary</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看哪些库未加载</span></span><br><span class="line">i sharelibrary</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 调试正在运行的程序</span></span><br><span class="line">gdb attach pid</span><br></pre></td></tr></table></figure>

<p>常用调试命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 进入 GDB 调试</span></span><br><span class="line">gdb $&#123;二进制执行文件&#125; $&#123;.core 文件&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置入参</span></span><br><span class="line">set args &quot;argv1&quot; &quot;argv2&quot;</span><br><span class="line">set args &quot;-p&quot;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看 堆栈信息</span></span><br><span class="line">BT</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置断点</span></span><br><span class="line">break func 或 line</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看断点信息</span></span><br><span class="line">break info</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 运行程序（到断点处暂停）</span></span><br><span class="line">r  (-- run )</span><br><span class="line"><span class="meta">#</span><span class="bash"> 单条语句执行</span></span><br><span class="line">n  (-- next )</span><br><span class="line"><span class="meta">#</span><span class="bash"> 继续运行程序</span></span><br><span class="line">c  (-- continue )</span><br><span class="line"><span class="meta">#</span><span class="bash"> 打印变量 i 的值</span></span><br><span class="line">p i  (--  print )</span><br></pre></td></tr></table></figure>

<p>多线程调试：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.csdn.net/tags/MtjaEgzsNzg0MTItYmxvZwO0O0OO0O0O.html">循环调试命令</a></p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> (1).方法一:</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> gdb --batch -ex <span class="string">&quot;thread apply all bt&quot;</span> -p &lt;被分析的进程的pid&gt;  将这条命令的打印dump出来</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --batch: 执行批处理，不进入交互模式</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --ex: 执行gdb 命令</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="string">&quot;thread apply all bt full&quot;</span>: 打印所有线程堆栈</span></span><br><span class="line">gdb --batch -ex &quot;thread apply all bt&quot; -p &lt;被分析的进程的pid&gt;  将这条命令的打印dump出来</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> (2).方法二:</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> gdb -q --batch --ex <span class="string">&quot;set height 0&quot;</span> -ex <span class="string">&quot;thread apply all bt full&quot;</span> [可执行文件] [core文件]</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -q: 不打印gdb的版权消息</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --batch: 执行批处理，不进入交互模式</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --ex: 执行gdb 命令</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="string">&quot;set height 0&quot;</span>: 不对输出进行分页</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="string">&quot;thread apply all bt full&quot;</span>: 打印所有线程堆栈</span></span><br><span class="line">gdb -q --batch --ex &quot;set height 0&quot; -ex &quot;thread apply all bt full&quot; /usr/bin/orchagent /core_files/orchagent.1667560417.35.core</span><br></pre></td></tr></table></figure>

<h2 id="11-16-过滤-Err-日志"><a href="#11-16-过滤-Err-日志" class="headerlink" title="11.16. 过滤 Err 日志"></a>11.16. 过滤 Err 日志</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">grep -i err syslog | fgrep -v liblogging | fgrep -v lldp | fgrep -v telemetry | fgrep -v snmp | fgrep -v ntpd | fgrep -v &#x27;INFO kernel&#x27; | fgrep -v &#x27;INFO containerd&#x27;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> sudo zgrep -aE <span class="string">&#x27; ERR| Err| err| FAIL| Fail| fail|ABRT|Traceback&#x27;</span> /var/<span class="built_in">log</span>/syslog.x.gz</span></span><br></pre></td></tr></table></figure>

<h2 id="11-17-查看指定时间段修改过-syslog-文件中特定内容"><a href="#11-17-查看指定时间段修改过-syslog-文件中特定内容" class="headerlink" title="11.17. 查看指定时间段修改过 syslog 文件中特定内容"></a>11.17. 查看指定时间段修改过 syslog 文件中特定内容</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rm /tmp/start &gt; /etc/null 2&gt;&amp;1; touch --date &quot;2022-05-04 00:00:00&quot; /tmp/start &amp;&amp; \</span><br><span class="line">rm /tmp/end &gt; /etc/null 2&gt;&amp;1; touch --date &quot;2022-12-30 23:00:00&quot; /tmp/end &amp;&amp; \</span><br><span class="line">rm $HOME/port_flapping.log; cd /var/log/; find -type f -name &#x27;syslog*&#x27; -newer /tmp/start -not -newer /tmp/end -printf &quot;%T@\t%p\n&quot; | sort -n | cut -f 2- | xargs -t -I &#123;&#125; zgrep -E &#x27;Bridge: port [[:digit:]]&#123;1,2&#125;\(Ethernet[[:digit:]]&#123;1,2&#125;\) entered disabled state&#x27; &#123;&#125; &gt;&gt; $HOME/port_flapping.log; wc -l $HOME/port_flapping.log</span><br></pre></td></tr></table></figure>

<h2 id="11-18-Logrotate"><a href="#11-18-Logrotate" class="headerlink" title="11.18. Logrotate"></a>11.18. Logrotate</h2><p>每十分钟周期检测，超过其文件阈值的才会压缩，一般不会：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/cron.d/logrotate</span><br><span class="line">*/10 * * * * root /usr/bin/pkill -9 logrotate &gt; /dev/null 2&gt;&amp;1; /usr/sbin/logrotate /etc/logrotate.conf &gt; /dev/null 2&gt;&amp;1</span><br></pre></td></tr></table></figure>

<p>强制压缩轮转命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /usr/sbin/logrotate -f /etc/logrotate.d/rsyslog</span><br></pre></td></tr></table></figure>

<p>轮转某目录下多个文件（通配符）</p>
<blockquote>
<p>需先手动创建 &#x2F;var&#x2F;log&#x2F;news&#x2F;old</p>
</blockquote>
<p>新建配置文件：&#x2F;etc&#x2F;logrotate.d&#x2F;multiple</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/var/log/news/ABC-*.log &#123;</span><br><span class="line">    size 100K</span><br><span class="line">    rotate 10</span><br><span class="line">    olddir /var/log/news/old</span><br><span class="line">    missingok</span><br><span class="line">    notifempty</span><br><span class="line">    compress</span><br><span class="line">    sharedscripts</span><br><span class="line">    postrotate</span><br><span class="line">        /bin/kill -HUP $(cat /var/run/rsyslogd.pid)</span><br><span class="line">    endscript</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试 OK：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 强制轮转</span></span><br><span class="line">/usr/sbin/logrotate -vf /etc/logrotate.d/multiple</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 定时任务调起也正常</span></span><br></pre></td></tr></table></figure>

<h2 id="11-19-系统内存超出-OOM-解决方法"><a href="#11-19-系统内存超出-OOM-解决方法" class="headerlink" title="11.19. 系统内存超出 OOM 解决方法"></a>11.19. 系统内存超出 OOM 解决方法</h2><p>无法执行任何命令时</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 手动触发OOM Killer</span></span><br><span class="line">sudo su root</span><br><span class="line"><span class="meta">#</span><span class="bash"> 启用 SysRq 所有功能</span></span><br><span class="line">echo 1 &gt; /proc/sys/kernel/sysrq</span><br><span class="line"><span class="meta">#</span><span class="bash"> 调用 oom Killer 来杀死占用内存的进程</span></span><br><span class="line">echo f &gt; /proc/sysrq-trigger</span><br><span class="line"><span class="meta">#</span><span class="bash"> | b | 将立即重新启动系统，而不同步或卸载磁盘。 |</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> | c | 如果配置，将执行系统崩溃并进行故障转储。 |</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> | d | 显示所有持有的锁。 |</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> | e | 向除 init 之外的所有进程发送 SIGTERM。 |</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> | f | 将调用 oom Killer 来杀死占用内存的进程，但如果无法杀死任何进程，请不要惊慌。 |</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> | g | 由 kgdb（内核调试器）使用 |</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> | h | 将显示帮助（实际上，除了此处列出的键之外的任何其他键都将显示帮助。但h很容易记住:-) |</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> | i | 向除 init 之外的所有进程发送 SIGKILL。 |</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> | j | 强制“解冻”- 文件系统被 FIFREEZE ioctl 冻结。 |</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> | k | 安全访问密钥 (SAK) 终止当前虚拟控制台上的所有程序。注意：请参阅下面 SAK 部分的重要注释。 |</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> | l | 显示所有活动 CPU 的堆栈回溯。 |</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> | m | 将当前内存信息转储到您的控制台。 |</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> | n | 用于使 RT 任务变得更好 |</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> | o | 将关闭您的系统（如果已配置并支持）。 |</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> | p | 将当前寄存器和标志转储到您的控制台。 |</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> | q | 将转储所有武装 hrtimers 的每个 CPU 列表（但不是常规的 timer_list 计时器）以及有关所有 Clockevent 设备的详细信息。 |</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> | r | 关闭键盘原始模式并将其设置为 XLATE。 |</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> | s | 将尝试同步所有已安装的文件系统。 |</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> | t | 将当前任务列表及其信息转储到您的控制台。 |</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> | u | 将尝试以只读方式重新挂载所有已挂载的文件系统。 |</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> | v | 强制恢复帧缓冲区控制台 |</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> | v | 导致 ETM 缓冲区转储 [ARM 特定] |</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> | w | 转储处于不可中断（阻塞）状态的任务。 |</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> | x | 由 ppc/powerpc 平台上的 xmon 接口使用。显示 sparc64 上的全局 PMU 寄存器。转储 MIPS 上的所有 TLB 条目。 |</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> | y | 显示全局 CPU 寄存器 [SPARC-64 特定] |</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> | z | 转储 ftrace 缓冲区 |</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> | 0-9 | 设置控制台日志级别，控制将哪些内核消息打印到控制台。（0，例如，只有紧急消息（例如 PANICs 或 OOPSes）才会发送到您的控制台。） |</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 或（下方触发oom Killer命令可能无内存 fork 执行）</span></span><br><span class="line">sudo sysctl -w vm.oom_kill_allocating_task=1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 禁用 SysRq 所有功能</span></span><br><span class="line">echo 0 &gt; /proc/sys/kernel/sysrq</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 重启设备</span></span><br><span class="line">/sbin/reboot -f &gt; /dev/null 2&gt;&amp;1 &amp;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 检查</span></span><br><span class="line">sudo apt install htop</span><br><span class="line">sudo htop</span><br><span class="line">click F6 to sort and select PERCENT_MEM -&gt; Enter</span><br><span class="line">Select the programs that you do not need but are eating most of the memory ( up and down arrow can be used)</span><br><span class="line">F9 and SIGKILL</span><br></pre></td></tr></table></figure>

<h2 id="11-20-启动加载文件"><a href="#11-20-启动加载文件" class="headerlink" title="11.20. 启动加载文件"></a>11.20. 启动加载文件</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat /mnt/flash/boot-config</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 对应 ansible/roles/eos/files/boot-config</span></span><br></pre></td></tr></table></figure>

<h1 id="12-其他"><a href="#12-其他" class="headerlink" title="12. 其他"></a>12. 其他</h1><h2 id="12-1-配置-Loopback-IP"><a href="#12-1-配置-Loopback-IP" class="headerlink" title="12.1. 配置 Loopback IP"></a>12.1. 配置 Loopback IP</h2><ul>
<li><p>方法 1： 手动配置</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> check</span></span><br><span class="line">ip addr show Loopback1</span><br><span class="line"></span><br><span class="line">sudo config interface ip add Loopback1 10.8.104.20/32</span><br><span class="line">sudo config interface ip add loopback1 10.249.133.226/32</span><br><span class="line">sudo config interface ip add Loopback1 FC00:1::20/128</span><br><span class="line"><span class="meta">#</span><span class="bash"> sudo config interface ip add Loopback1 fdbd:51cd::0a45:ffff/128</span></span><br><span class="line">sudo config interface ip add Loopback2 173.173.173.173/32</span><br></pre></td></tr></table></figure>
</li>
<li><p>方法 2：在 config_db.json 中配置</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&quot;LOOPBACK_INTERFACE&quot;: &#123;</span><br><span class="line">    &quot;Loopback0&quot;: &#123;&#125;,</span><br><span class="line">    &quot;Loopback1&quot;: &#123;&#125;,</span><br><span class="line">    &quot;Loopback0|10.1.0.32/32&quot;: &#123;&#125;,</span><br><span class="line">    &quot;Loopback0|FC00:1::32/128&quot;: &#123;&#125;,</span><br><span class="line">    &quot;Loopback1|10.8.104.21/32&quot;: &#123;&#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="12-2-更改-Hostname"><a href="#12-2-更改-Hostname" class="headerlink" title="12.2. 更改 Hostname"></a>12.2. 更改 Hostname</h2><ul>
<li><p>方法 1：命令行修改</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">config hostname sonic-DUT1</span><br><span class="line">config save</span><br><span class="line"><span class="meta">#</span><span class="bash"> 检查</span></span><br><span class="line">grep &#x27;hostname&#x27; /etc/sonic/config_db.json</span><br><span class="line"><span class="meta">#</span><span class="bash"> 重启生效</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>方法 2：直接修改配置文件 &#x2F;etc&#x2F;sonic&#x2F;config_db.json</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&quot;DEVICE_METADATA&quot;: &#123;</span><br><span class="line">        &quot;localhost&quot;: &#123;</span><br><span class="line">            &quot;bgp_asn&quot;: &quot;65001&quot;,</span><br><span class="line">            &quot;cloudtype&quot;: null,</span><br><span class="line">            &quot;deployment_id&quot;: &quot;1&quot;,</span><br><span class="line">            &quot;docker_routing_config_mode&quot;: &quot;separated&quot;,</span><br><span class="line">            &quot;hostname&quot;: &quot;sonic-DUT1&quot;,</span><br><span class="line">            &quot;hwsku&quot;: &quot;mavericks&quot;,</span><br><span class="line">            &quot;platform&quot;: &quot;x86_64-accton_xxx&quot;,</span><br><span class="line">            &quot;mac&quot;: &quot;11:22:33:44:55:66&quot;,</span><br><span class="line">            &quot;region&quot;: null,</span><br><span class="line">            &quot;type&quot;: &quot;ToRRouter&quot;,</span><br><span class="line">            &quot;default_bgp_status&quot;: &quot;up&quot;,</span><br><span class="line">            &quot;default_pfcwd_status&quot;: &quot;disable&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>
</li>
<li><p>方法 3：linux 方式修改</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 切换至 root</span></span><br><span class="line">su - root</span><br><span class="line"></span><br><span class="line">TARGET_HOSTNAME=&#x27;n11-119-079&#x27;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改 hostname</span></span><br><span class="line">sudo hostnamectl set-hostname $TARGET_HOSTNAME</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改 /etc/hosts</span></span><br><span class="line">sudo vi /etc/hosts</span><br><span class="line">sed -i &quot;s/127.0.0.1 $HOSTNAME/127.0.0.1 $TARGET_HOSTNAME/g&quot; /etc/hosts</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改 /etc/hostname</span></span><br><span class="line">sudo vi /etc/hostname</span><br><span class="line">sed -i &quot;s/$HOSTNAME/$TARGET_HOSTNAME/g&quot; /etc/hostname</span><br><span class="line"></span><br><span class="line">tail /etc/hostname /etc/hosts</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 生效</span></span><br><span class="line">/etc/init.d/hostname.sh start</span><br><span class="line"><span class="meta">#</span><span class="bash"> 或</span></span><br><span class="line">invoke-rc.d hostname.sh start</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 备注：临时修改 HOSTNAME</span></span><br><span class="line">hostname $TARGET_HOSTNAME</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="12-3-修改-Linux-用户登录时默认shell"><a href="#12-3-修改-Linux-用户登录时默认shell" class="headerlink" title="12.3. 修改 Linux 用户登录时默认shell"></a>12.3. 修改 Linux 用户登录时默认shell</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo chsh --shell /usr/bin/bash vnetops</span><br><span class="line">sudo chsh --shell /usr/bin/bash admin</span><br><span class="line">sudo chsh --shell /usr/bin/bash admin</span><br><span class="line">sudo chsh --shell /usr/bin/bash xltops</span><br></pre></td></tr></table></figure>

<h2 id="12-4-一行指令修改密码"><a href="#12-4-一行指令修改密码" class="headerlink" title="12.4. 一行指令修改密码"></a>12.4. 一行指令修改密码</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo admin:123456 | chpasswd</span><br></pre></td></tr></table></figure>

<h2 id="12-5-通过-redis-key-宣告-x2F-撤销路由"><a href="#12-5-通过-redis-key-宣告-x2F-撤销路由" class="headerlink" title="12.5. 通过 redis key 宣告&#x2F;撤销路由"></a>12.5. 通过 redis key 宣告&#x2F;撤销路由</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 判断 redis 表项是否存在（已存在则无需添加）</span></span><br><span class="line">redis-cli -h 127.0.0.1 -n 4 -p 6379 exists &quot;BGP_NETWORK|192.168.0.90/32&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 宣告路由</span></span><br><span class="line">redis-cli -h 127.0.0.1 -n 4 -p 6379 hset &quot;BGP_NETWORK|192.168.0.90/32&quot; &quot;NULL&quot; &quot;NULL&quot;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 撤销路由</span></span><br><span class="line">redis-cli -h 127.0.0.1 -n 4 -p 6379 del &quot;BGP_NETWORK|192.168.0.90/32&quot;</span><br></pre></td></tr></table></figure>

<h2 id="12-6-查看-config-db-json-中配置的-BGP-NETWORK"><a href="#12-6-查看-config-db-json-中配置的-BGP-NETWORK" class="headerlink" title="12.6. 查看 config_db.json 中配置的 BGP_NETWORK"></a>12.6. 查看 config_db.json 中配置的 BGP_NETWORK</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sonic-cfggen -d -v &#x27;BGP_NETWORK&#x27; | grep -oP &quot;u&#x27;[0-9a-f\.:]+/[0-9]+&quot; |cut -d \&#x27; -f2</span><br></pre></td></tr></table></figure>

<h2 id="12-7-install-对比-cp"><a href="#12-7-install-对比-cp" class="headerlink" title="12.7. install 对比 cp"></a>12.7. install 对比 cp</h2><ul>
<li>Running 的进程不能随便 cp</li>
<li>若文件已存在：cp 会 清空旧文件内容并写拷贝新内容（若文件正在使用会失败）；install 会删除旧文件并新建文件</li>
<li>install 对象必须是文件，不能是目录 （可用 Dir&#x2F;* ）</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> cp test_file /dir/path/</span></span><br><span class="line">install -p -D -m 0755 test_file /dir/path/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 说明：</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将 abcd 拷贝纸 /opt/testDir/ 目录下</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -p 时间同步至目标目录</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -D 如果没有这个目录就创建，</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -m 0755 然后赋予 755 的权限</span></span><br></pre></td></tr></table></figure>

<h2 id="12-8-创建临时随机路径"><a href="#12-8-创建临时随机路径" class="headerlink" title="12.8. 创建临时随机路径"></a>12.8. 创建临时随机路径</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建临时文件夹</span></span><br><span class="line">mktemp -d -p /tmp</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建临时文件夹，存入变量 tmpdir</span></span><br><span class="line">tmpdir=`mktemp -d`</span><br></pre></td></tr></table></figure>

<h2 id="12-9-查看-Linux-账户-密文密码字符串"><a href="#12-9-查看-Linux-账户-密文密码字符串" class="headerlink" title="12.9. 查看 Linux 账户 密文密码字符串"></a>12.9. 查看 Linux 账户 密文密码字符串</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看 账户密码（第二项为密码的 SHA-512 加密）</span></span><br><span class="line">sudo grep &#x27;myops&#x27; /etc/shadow | cut -d : -f 2</span><br><span class="line">sudo grep &#x27;xltops&#x27; /etc/shadow | cut -d : -f 2</span><br><span class="line">sudo grep &#x27;vnetops&#x27; /etc/shadow | cut -d : -f 2</span><br><span class="line">sudo grep &#x27;admin&#x27; /etc/shadow | cut -d : -f 2</span><br><span class="line">sudo grep &#x27;vnet&#x27; /etc/shadow | cut -d : -f 2</span><br><span class="line">sudo grep &#x27;admin&#x27; /etc/shadow | cut -d : -f 2</span><br><span class="line">sudo grep &#x27;root&#x27; /etc/shadow | cut -d : -f 2</span><br><span class="line">sudo grep &#x27;haoleeson&#x27; /etc/shadow | cut -d : -f 2</span><br></pre></td></tr></table></figure>

<h2 id="12-10-罗列-service-服务"><a href="#12-10-罗列-service-服务" class="headerlink" title="12.10. 罗列 service 服务"></a>12.10. 罗列 service 服务</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl --type=service</span><br><span class="line">sudo systemctl --type=service --all</span><br></pre></td></tr></table></figure>

<h2 id="12-11-罗列内存中已加载-units"><a href="#12-11-罗列内存中已加载-units" class="headerlink" title="12.11. 罗列内存中已加载 units"></a>12.11. 罗列内存中已加载 units</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl list-units</span><br><span class="line">sudo systemctl list-units --type=service</span><br><span class="line">sudo systemctl list-units --type=timer</span><br><span class="line"><span class="meta">#</span><span class="bash"> 罗列失败的服务</span></span><br><span class="line">sudo systemctl list-units --state failed --type service</span><br></pre></td></tr></table></figure>

<h2 id="12-12-安装-thrift-0-13-0-命令"><a href="#12-12-安装-thrift-0-13-0-命令" class="headerlink" title="12.12. 安装 thrift 0.13.0 命令"></a>12.12. 安装 thrift 0.13.0 命令</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装依赖</span></span><br><span class="line">sudo apt-get install libboost-dev libboost-test-dev libboost-program-options-dev libboost-filesystem-dev libboost-thread-dev libevent-dev automake make libtool git flex bison pkg-config g++ libssl-dev</span><br><span class="line"></span><br><span class="line">wget http://archive.apache.org/dist/thrift/0.13.0/thrift-0.13.0.tar.gz</span><br><span class="line">tar -xzvf thrift-0.13.0.tar.gz</span><br><span class="line">cd thrift-0.13.0</span><br><span class="line">./bootstrap.sh</span><br><span class="line">./configure --with-cpp=yes --with-c_glib=no --with-java=no --with-ruby=no --with-erlang=no --with-go=no --with-nodejs=no</span><br><span class="line">make -j2 &amp;&amp; sudo make install</span><br><span class="line">cd lib/py</span><br><span class="line">sudo python setup.py install</span><br><span class="line">cd ../../..</span><br><span class="line">thrift --version</span><br></pre></td></tr></table></figure>

<h2 id="12-13-Mac电脑使用串口"><a href="#12-13-Mac电脑使用串口" class="headerlink" title="12.13. Mac电脑使用串口"></a>12.13. Mac电脑使用串口</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Mac 电脑连上串口（tty 终端）后，打开终端查询 串口号。</span></span><br><span class="line">ls /dev/*usbserial*</span><br><span class="line"><span class="meta">#</span><span class="bash"> 返回结果示例（14210 为串口 ID）:</span></span><br><span class="line">/dev/tty.usbserial14210</span><br><span class="line"><span class="meta">#</span><span class="bash"> 连接串口（tty 终端），命令为 screen /dev/tty.usbserial-<span class="variable">$&#123;&#125;</span> 115200</span></span><br><span class="line">screen $(ls /dev/tty.usbserial*) 115200</span><br></pre></td></tr></table></figure>

<h2 id="12-14-mac-下使用-minicom"><a href="#12-14-mac-下使用-minicom" class="headerlink" title="12.14. mac 下使用 minicom"></a>12.14. mac 下使用 minicom</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装 minicom</span></span><br><span class="line">brew install minicom</span><br></pre></td></tr></table></figure>

    </div>

    
    
    
      
  <div class="popular-posts-header">相关文章</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2021\09\12\SONIC\" rel="bookmark">开源白盒交换机系统 SONiC 简介</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2021\09\26\building_sonic\" rel="bookmark">sonic 全量编译及指定容器编译简介</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2021\09\28\install_sonic\" rel="bookmark">安装SONiC</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2021\11\22\sonic201911_lost_swss_rec_history_log_problem_and_fix\" rel="bookmark">sonic201911 丢失 swss.rec 历史日志问题及修复</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2021\12\17\sonic_underscore_prefixes_remaining_in_Redis_loglevel_db\" rel="bookmark">Redis loglevel_db 中残留2至n个下划线前缀的冗余表项问题</a></div>
    </li>
  </ul>


    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Network/" rel="tag"><i class="fa fa-tag"></i> Network</a>
              <a href="/tags/SONiC/" rel="tag"><i class="fa fa-tag"></i> SONiC</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2023/12/24/P4LearnNote/" rel="prev" title="P4学习笔记">
                  <i class="fa fa-chevron-left"></i> P4学习笔记
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2024/06/26/GoPprofToolUsage/" rel="next" title="Go pprof性能分析工具">
                  Go pprof性能分析工具 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2018 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">haoleeson</span>
</div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@next-theme/pjax@0.5.0/pjax.min.js" integrity="sha256-3NkoLDrmHLTYj7csHIZSr0MHAFTXth7Ua/DDt4MRUAg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script>

  
<script src="/js/third-party/search/local-search.js"></script>




  


  <script class="next-config" data-name="leancloud_visitors" type="application/json">{"enable":true,"app_id":"bCgWJUrF9NMLpHldLlFkJNUG-gzGzoHsz","app_key":"TLdQDR7gG7YiqEflCiR8wmz3","server_url":null,"security":false}</script>
  <script src="/js/third-party/statistics/lean-analytics.js"></script>


  <script src="https://cdn.jsdelivr.net/npm/quicklink@2.2.0/dist/quicklink.umd.js" integrity="sha256-4kQf9z5ntdQrzsBC3YSHnEz02Z9C1UeW/E9OgnvlzSY=" crossorigin="anonymous"></script>
  <script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":false,"archive":false,"delay":true,"timeout":3000,"priority":true,"url":"https://haoleeson.cn/2024/01/20/SONICUsefullCmd/"}</script>
  <script src="/js/third-party/quicklink.js"></script>

</body>
</html>
